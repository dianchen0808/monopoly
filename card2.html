<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Co-Action Memory</title>
<style>
  /* ====== è‰²ç¥¨ ====== */
:root{
  --ink:#1f2937;          /* æ·±ç°å¢¨è‰²ï¼šä¸€èˆ¬æ–‡å­—é¡è‰² */
  --muted:#64748b;        /* æ·ºç°è—å­—ï¼šæç¤ºæ–‡å­— */
  --line:rgba(0,0,0,.12); /* ç·šæ¢ï¼šåˆ†éš”ã€é‚Šæ¡† */

  --brand:#0E63E6;        /* ä¸»è—ï¼šä¸»è¦æŒ‰éˆ•/å¼·èª¿ */
  --brand-dark:#0A47A1;   /* æ·±è—ï¼šhover æˆ–æ¬¡è¦å¼·èª¿ */
  --ok:#20B386;           /* ç¶ è‰² (ok/æ­£å‘å¼·èª¿) */
  --bad:#ef4444;          /* éŒ¯èª¤ç´… */

  --card:#ffffff;         /* å¡ç‰‡ç™½åº• */
  --card-2:#f8fafc;       /* æ·ºç°è—å¡ç‰‡èƒŒæ™¯ */
  --bg:#f1f5f9;           /* é é¢æ•´é«”èƒŒæ™¯æ·ºç°è— */

  --aurora-1:#0E63E6;     /* è—å…‰ï¼ˆå°æ‡‰ä¸»è—ï¼‰ */
  --aurora-2:#38bdf8;     /* æ·ºè—å…‰ */
  --aurora-3:#20B386;     /* ç¶ å…‰ */
  --aurora-4:#94a3b8;     /* ç°å…‰ */
}

  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,"Noto Sans TC","Segoe UI",Roboto,Arial,sans-serif;}
  a{color:#7eead3;text-decoration:none} a:hover{text-decoration:underline}

  /* ====== èƒŒæ™¯å±¤ ====== */
  .bg-img{
    position:fixed; inset:0; z-index:0;
    background:url('background2.png') center/cover no-repeat;
    /*çœ‹é‚„æ˜¯è¦é€™è¡Œ? background:url('ChatGPT Image 2025å¹´9æœˆ30æ—¥ ä¸‹åˆ01_28_08.jpg') center/cover no-repeat;*/
    opacity:.35; filter:blur(2px);
  }
  .stage{
  position:fixed;
  inset:0;
  z-index:1;
  overflow:hidden;
  pointer-events:none;
  }

  /* âœ… é›²æœµ 1 */
  .cloud{
  position:absolute;
  top:10%;
  left:-200px;                         /* âœ… åˆå§‹ä½ç½®åœ¨è¢å¹•å¤– */
  width:180px;                         /* âœ… ä¿æŒåŸæœ¬å¤§å° */
  animation:moveCloud 40s linear infinite;
  }

  /* âœ… é›²æœµ 2 */
  .cloud2{
  position:absolute;
  top:20%;
  left:-200px;                         /* âœ… åˆå§‹ä½ç½®åœ¨è¢å¹•å¤– */
  width:140px;                         /* âœ… ä¿æŒåŸæœ¬å¤§å° */
  animation:moveCloud 60s linear infinite reverse;
  }
  
  /* âœ… è·‘å‹•å‹•ç•«ï¼ˆä¸ç”¨æ”¹ï¼‰ */
  @keyframes moveCloud{from{left:-200px}to{left:100%}}
  .windmill{position:absolute;left:6%;bottom:10%;width:160px;}
  .blade{animation:spin 8s linear infinite;transform-origin:50% 60%;}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  .trees{position:absolute;right:6%;bottom:8%;width:200px;}
  .bg{position:fixed; inset:0; z-index:1; pointer-events:none;}
  .blob{position:absolute; filter:blur(70px); opacity:.35; mix-blend-mode:screen;
    transform-origin:center center; animation:float 16s ease-in-out infinite alternate;}
  .b1{ width:55vw; height:55vw; left:-10vw; top:-12vh;
    background:radial-gradient(circle at 30% 30%, var(--aurora-1), transparent 55%); animation-duration:18s;}
  .b2{ width:60vw; height:60vw; right:-15vw; top:-6vh;
    background:radial-gradient(circle at 70% 20%, var(--aurora-2), transparent 55%); animation-duration:22s;}
  .b3{ width:50vw; height:50vw; left:10vw; bottom:-25vh;
    background:radial-gradient(circle at 40% 70%, var(--aurora-3), transparent 60%); animation-duration:20s;}
  .b4{ width:45vw; height:45vw; right:5vw; bottom:-20vh;
    background:radial-gradient(circle at 60% 60%, var(--aurora-4), transparent 60%); animation-duration:19s;}
  @keyframes float{0%{transform:translate3d(0,0,0) scale(1)}100%{transform:translate3d(2vw,-1.5vh,0) scale(1.05)}}
  #bg-canvas{position:fixed; inset:0; z-index:5; pointer-events:none;}

  /* ====== éŠæˆ²æ©Ÿå° ====== */
  .wrap{max-width:1100px;margin:20px auto;padding:0 16px;position:relative;z-index:2}
  header{display:flex;gap:16px;align-items:center;flex-wrap:wrap;justify-content:space-between;margin-bottom:12px}
  h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.2px}
  .meta{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

.pill{
  background:var(--card-2);           /* æ·ºç°è—åº• */
  border:1px solid var(--line);
  border-radius:999px;                /* ä¿æŒè† å›Šå½¢ç‹€ */
  padding:6px 12px;
  font-size:14px;
  color:var(--ink);                   /* æ·±ç°å­— */
}

 .select{
  appearance:none;
  background:var(--card-2);            /* âœ… èƒŒæ™¯æ”¹å¡ç‰‡æ·ºç°è— */
  color:var(--ink);                    /* âœ… æ–‡å­—ç”¨æ·±ç°å¢¨è‰² */
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 10px;
  font-size:14px;
}

.btn{
  background:linear-gradient(135deg,var(--brand),var(--brand-dark));  /* âœ… æ”¹æˆä¸»è—+æ·±è— */
  color:#fff;                               /* âœ… æŒ‰éˆ•æ–‡å­—æ”¹ç™½ */
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 22px rgba(14,99,230,.25); /* âœ… æ”¹æˆä¸»è—é™°å½± */
}

  .btn:hover{filter:brightness(1.05)}
  .bar{
  height:10px;
  background:var(--card-2);                 /* âœ… èƒŒæ™¯æ·ºç°è— */
  border-radius:999px;
  overflow:hidden;
  border:1px solid var(--line);
}
.bar>span{
  display:block;height:100%;width:100%;
  background:linear-gradient(90deg,var(--ok),#38bdf8);  /* âœ… ç¶ è‰²åˆ°æ·ºè—è‰² */
}

  .panel{display:grid;grid-template-columns:1fr 320px;gap:16px}
  @media (max-width:1024px){.panel{grid-template-columns:1fr}}
  .grid{display:grid;gap:10px;margin-top:14px}
  .side{
  background:var(--card-2);                 /* âœ… å´é‚Šæ¬„èƒŒæ™¯æ”¹æ·ºç°è— */
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  backdrop-filter:blur(8px);
}
.side h3{color:var(--brand);}              /* âœ… æ¨™é¡Œæ–‡å­—ç”¨ä¸»è— */
.tip{font-size:13px;color:var(--muted);}   /* âœ… å·²ç”¨ muted æ·ºç°è—ï¼Œä¸éœ€é¡å¤–æ”¹ */
.kv{font-size:13px;color:var(--muted);}


  /* ====== å¡ç‰‡ ====== */
  .card{position:relative;aspect-ratio:1/1;perspective:1200px;cursor:pointer;user-select:none}
  .inner{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .28s ease}
  .card.flipped .inner,.card.matched .inner{transform:rotateY(180deg)}
  .face{position:absolute;inset:0;border-radius:14px;display:flex;align-items:center;
    justify-content:center;backface-visibility:hidden;overflow:hidden}
  .front{
  background:var(--card-2);                 /* âœ… èƒŒæ™¯æ·ºç°è— */
  border:1px solid var(--line);
}
.back{
  transform:rotateY(180deg);
  background:var(--card);                   /* âœ… èƒŒæ™¯ç™½åº• */
  border:1px solid var(--line);
}
.emoji{font-size:38px;line-height:1}
.label{
  position:absolute;bottom:10px;left:0;right:0;
  text-align:center;font-size:12px;
  color:var(--muted);                       /* âœ… æ–‡å­—é¡è‰²æ”¹æˆ muted ç°è— */
}


  /* ====== å…¶ä»– UI ====== */
  .chips{display:flex;flex-wrap:wrap;gap:6px}
  .chip{
  background:rgba(14,99,230,.14);           /* âœ… æ”¹æˆè—è‰²é€æ˜åº• */
  border:1px solid rgba(14,99,230,.35);     /* âœ… è—è‰²é‚Šæ¡† */
  color:var(--brand-dark);                  /* âœ… æ–‡å­—é¡è‰²ç”¨æ·±è— */
  font-size:12px;border-radius:999px;padding:4px 8px
}

.toast{
  position:fixed;              /* âœ… å›ºå®šå®šä½ */
  left:50%;                    /* âœ… æ°´å¹³ç½®ä¸­ */
  bottom:24px;                 /* âœ… åº•éƒ¨ä½ç½® */
  transform:translateX(-50%);  /* âœ… ä¿æŒæ­£ä¸­ */
  background:var(--card);      /* âœ… ç™½åº• */
  color:var(--ink);            /* âœ… æ·±ç°å­— */
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 14px;
  font-size:14px;
  opacity:0;
  transition:opacity .2s,transform .2s;
  z-index:5;
  box-shadow:0 4px 12px rgba(0,0,0,.1);  /* âœ… å’Œ .know ä¸€è‡´çš„æµ®å‡ºæ„Ÿ */
}


  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
  .overlay{position:fixed;inset:0;background:rgba(2,8,14,.7);display:none;
    align-items:center;justify-content:center;padding:16px;z-index:10;backdrop-filter:blur(4px)}
  .dialog{
  background:var(--card);                   /* âœ… å°è©±æ¡†ç™½åº• */
  color:var(--ink);                         /* âœ… æ–‡å­—æ·±ç°å¢¨è‰² */
  border-radius:16px;
  max-width:560px;width:100%;padding:20px;
  text-align:center;
  border:1px solid var(--line);
}

  .dialog h2{margin:0 0 8px}
  .row{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap}
  .input{
  width:240px;
  background:var(--card-2);                 /* âœ… æ·ºç°è—åº• */
  color:var(--ink);                         /* âœ… æ·±ç°å­— */
  border:1px solid var(--line);
  border-radius:10px;
  padding:9px 10px;
}

  table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 6px;
  font-size:13px;
  color:var(--ink);                         /* âœ… è¡¨æ ¼å­—é¡è‰²æ·±ç° */
}
tr{background:var(--card-2);border:1px solid var(--line);}  /* âœ… åˆ—èƒŒæ™¯æ·ºç°è— */

.know{
  position:fixed;                /* âœ… å›ºå®šå®šä½ */
  left:50%;                      /* âœ… æ°´å¹³ç½®ä¸­ */
  bottom:88px;                   /* âœ… åº•éƒ¨æµ®å‡ºä½ç½® */
  transform:translateX(-50%);    /* âœ… å‘å·¦ç§»åŠå¯¬ä¿æŒæ­£ä¸­ */
  background:var(--card);        /* âœ… æ·ºè‰²ç™½åº• */
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px 14px;
  display:none;
  max-width:560px;
  width:calc(100% - 32px);
  z-index:9;                     /* âœ… æµ®åœ¨æœ€ä¸Šå±¤ */
  color:var(--ink);              /* âœ… ä¸»æ–‡å­—æ·±ç° */
  box-shadow:0 4px 12px rgba(0,0,0,.1);  /* âœ… æ·ºè‰²åº•éœ€è¦é™°å½±ä¾†å‡¸é¡¯ */
}
.know strong{
  color:var(--brand);            /* âœ… å¼·èª¿å­—æ”¹æˆä¸»è— */
}

#helpBtn{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  color:var(--brand);         /* âœ… ä¸»è—è‰² */
}
#helpBtn:hover{color:var(--brand-dark);}


/* ====== æ•™å­¸å¼•å°æ¡† ====== */
.guide{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);       /* åŠé€æ˜é»‘èƒŒæ™¯ */
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.guide-card{
  background:var(--card);          /* ç™½åº•ï¼ˆç”¨ä½ çš„è‰²ç¥¨ï¼‰ */
  color:var(--ink);
  border-radius:16px;
  padding:20px;
  max-width:420px;
  width:calc(100% - 40px);
  box-shadow:0 8px 24px rgba(0,0,0,.15);
  text-align:left;
}
.guide-card h2{color:var(--brand);}
.steps{margin:14px 0;display:grid;gap:10px;font-size:14px;color:var(--ink);}
.step b{font-size:18px;margin-right:6px;}
.guide-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px;}
.icon-btn{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:14px;
}


/* ====== é–‹å§‹ç•«é¢ ====== */

.overlay-start{
  position:fixed;
  inset:0;
  /*background:var(--bg);*/
  background:url('home1.1.png') center/cover no-repeat; 
  background-color:#0E63E6; 
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:50; /* âœ… ä¿è­‰æœ€ä¸Šå±¤ */
}
.start-box{
  background:var(--card);
  padding:30px 40px;
  border-radius:16px;
  text-align:center;
  box-shadow:0 6px 18px rgba(0,0,0,.2);

  /* âœ… å…ˆåšæ·¡å…¥ï¼Œå†æ¥å½ˆè·³ */
  animation: fadeIn 0.8s ease-out, bounce 1.6s 0.8s infinite;
  transform-origin: center bottom;
}

/* âœ… æ·¡å…¥å‹•ç•« */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to   { opacity: 1; transform: scale(1); }
}

/* âœ… è·³å‹•å‹•ç•« */
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-18px);
  }
  60% {
    transform: translateY(-10px);
  }
}


.start-box h1{margin:0 0 16px;color:var(--brand);}
.start-box p{margin:0 0 20px;color:var(--muted);}
.start-box button{
  background:linear-gradient(135deg,var(--brand),var(--brand-dark));
  color:#fff;
  border:none;
  border-radius:10px;
  padding:12px 20px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}  

/* ====== æ•™å­¸æ¡† ====== */
.overlay-tutorial{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none; /* âœ… é è¨­éš±è— */
  align-items:center;
  justify-content:center;
  z-index:40;
}
.tutorial-box{
  background:var(--card);
  padding:24px 28px;
  border-radius:16px;
  text-align:center;
  max-width:420px;
  color:var(--ink);
  box-shadow:0 6px 20px rgba(0,0,0,.25);
}
.tutorial-box h2{margin:0 0 12px;color:var(--brand);}
.tutorial-box p{margin:0 0 20px;}
.tutorial-box button{
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  font-size:14px;
  cursor:pointer;
}

/* --- æ–°å¢çš„èªè¨€åˆ‡æ›æŒ‰éˆ•æ¨£å¼ --- */

/* 1. ç”¨æ–¼ã€Œé–‹å§‹ç•«é¢ã€çš„æŒ‰éˆ• */
.lang-switch-btn {
  display: block; /* è®“å®ƒç¨ä½”ä¸€è¡Œ */
  width: -moz-fit-content; /* èˆŠç‰ˆ Firefox */
  width: fit-content; /* å…§å®¹è‡ªé©æ‡‰å¯¬åº¦ */
  margin: 0 auto 16px auto; /* æ°´å¹³ç½®ä¸­ã€ä¸‹æ–¹é–“è· 16px */
  background: var(--card-2);  /* æ·ºç°è—åº• */
  color: var(--muted);       /* æ·ºç°è—å­— */
  border: 1px solid var(--line);
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 14px;
  text-decoration: none;
  transition: background .2s;
}
.lang-switch-btn:hover {
  background: var(--bg); /* æ‡¸åœæ™‚è®Šè‰² */
  color: var(--ink);
  text-decoration: none;
}

/* 2. ç”¨æ–¼ã€Œæ•™å­¸æ¡†ã€çš„æŒ‰éˆ• (é å·¦) */
.guide-actions a.icon-btn {
  text-decoration: none;
  margin-right: auto; /* é—œéµï¼šæŠŠå®ƒæ¨åˆ°æœ€å·¦é‚Š */
}

/* 3. ç”¨æ–¼ã€ŒéŠæˆ²æ¨™é ­ã€çš„æŒ‰éˆ• (ç¢ºä¿ a.pill æ²’åº•ç·š) */
header .meta a.pill {
  text-decoration: none;
}
header .meta a.pill:hover {
  background: var(--card);
  text-decoration: none;
}
/* --- æ¨£å¼æ–°å¢çµæŸ --- */

</style>
</head>

<body>
<!-- ====== é–‹å§‹ç•«é¢ ====== -->
<div id="start-screen" class="overlay-start">
  <div class="start-box">
  <h1>SDGs Memory Matching Game</h1>
  <p>Come challenge yourself! Match the cards and fostering sustainability literacy ğŸŒ±</p>
  <a href="card1.html" class="lang-switch-btn">åˆ‡æ›ç‚ºä¸­æ–‡</a>
  <button id="start-btn">Start Game</button>
</div>
</div>

<!-- ====== æ•™å­¸æ¡† ====== -->
<!-- æ•™å­¸å¼•å°ï¼ˆé¦–æ¬¡é¡¯ç¤ºï¼Œä¹Ÿå¯é»â“å†é–‹ï¼‰ -->
<div class="guide" id="guide">
  <div class="guide-card">
    <h2 style="margin:0 0 6px">How to Play</h2>
    <div class="tip" style="color:#246084">3 steps to get started quickly</div>
    <div class="steps">
      <div class="step"><b>ğŸ–±ï¸</b><strong>1ï¼‰Click two cards</strong><br>If the icons match, the pair is successful.</div>
      <div class="step"><b>â±ï¸</b><strong>2ï¼‰Keep track of time</strong><br>Finish all matches within the time limit.</div>
      <div class="step"><b>ğŸ¯</b><strong>3ï¼‰Unlock Knowledge</strong><br>Each successful pair unlocks SDGs knowledge.</div>
    </div>
    <div class="guide-actions">
      <a href="card1.html" class="icon-btn">ä¸­æ–‡</a>
      
      <button class="btn" id="startBtn">Start Challenge</button>
      <button class="icon-btn" id="skipBtn">Skip</button>
    </div>
  </div>
</div>

<!-- èƒŒæ™¯ -->
<div class="bg-img"></div>
<div class="stage">
    <img src="cloud.png" class="cloud">
    <img src="cloud1.png" class="cloud2">
<!-- âœ… é¢¨è»Š -->
    <svg class="windmill" viewBox="0 0 200 200">
      <!-- âœ… æ¼¸å±¤å®šç¾© -->
      <defs>
        <linearGradient id="bladeGradient" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#7FC0FF"/>
          <stop offset="100%" stop-color="#0E63E6"/>
        </linearGradient>
      </defs>

      <!-- âœ… ä¸­å¿ƒåœ“ -->
      <circle cx="100" cy="120" r="14" fill="#fff" stroke="#555" stroke-width="3"/>

      <!-- âœ… è‘‰ç‰‡ï¼ˆåŠ äº†åœ“è§’ rx/ryï¼‰ -->
      <g class="blade">
        <rect x="92" y="10" width="16" height="100" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="92" y="120" width="16" height="70" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="30" y="112" width="70" height="16" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="100" y="112" width="70" height="16" rx="6" ry="6" fill="url(#bladeGradient)"/>
      </g>
    </svg>
  <svg class="trees" viewBox="0 0 200 200">
    <circle cx="60" cy="140" r="40" fill="#C9F0DD" stroke="#6aa787" stroke-width="4"/>
    <circle cx="140" cy="160" r="30" fill="#D6F6E6" stroke="#6aa787" stroke-width="4"/>
  </svg>
</div>
<div class="bg">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <div class="blob b4"></div>
</div>
  <canvas id="bg-canvas"></canvas>

<!-- éŠæˆ²æ©Ÿå° -->
<div class="wrap">
  <header>
    <h1>Co-Action Memory</h1>
    <div class="meta">
      <select id="levelSel" class="select">
        <option value="0">SDG 13 â€” Climate Action </option>
        <option value="1">SDG 10 â€” Reduced Inequalities </option>
        <option value="2">SDG 5 â€” Gender Equality </option>
        <option value="3">SDG 11 â€” Sustainable Cities </option>
        <option value="4">SDG 12 â€” Responsible Consumption & Production </option>
        <option value="5">SDG 17 â€” Partnerships for the Goals </option>
      </select>
      <a href="card1.html" class="pill">ä¸­æ–‡</a>
      <div class="pill">Time:<b id="time">--</b></div>
      <div class="pill">Moves:<b id="moves">0</b></div>
      <div class="pill">Matches:<b id="matches">0</b>/<b id="pairs">--</b></div>
      <button class="btn" id="restartBtn">Restart</button>
      <button class="icon-btn" id="helpBtn">â“</button>
    </div>
  </header>
  <div class="bar"><span id="timebar"></span></div>
  <div class="panel">
    <div><div id="grid" class="grid"></div><div id="know" class="know"></div></div>
    <aside class="side">
      <h3>Mission / Progress</h3>
      <div id="mission" class="tip"></div>
      <div class="chips" id="progressChips"></div>
      <div class="tip">Unlocked Facts:<b id="unlocked">0</b>/<b id="need">--</b></div>
      <hr>
      <h3>SDGs Stage Progress</h3>
      <div class="tip">Current Stage:<b id="stageNow">--</b></div>
      <hr><h3>Local Leaderboard</h3>
      <table id="rank"><thead><tr><th>#</th><th>Nickname</th><th>Stage</th><th>Time</th><th>Moves</th><th>Date</th></tr></thead><tbody></tbody></table>
    </aside>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="overlay" id="overlay">
  <div class="dialog">
    <h2 id="resultTitle">Time's Up!</h2>
    <p id="resultText"></p>
    <div class="row"><input id="nick" class="input" placeholder="Nickname"><button class="btn" id="saveScoreBtn">Save Score</button></div>
    <div class="row"><input id="shareUrl" class="input" readonly><button class="btn" id="copyBtn">Copy Link</button></div>
    <div class="row"><button class="btn" id="playAgainBtn">Play Again</button></div>
  </div>
</div>

<script>
/* === JS éŠæˆ²é‚è¼¯ (ç•¥ï¼Œè·Ÿä¹‹å‰ç›¸åŒï¼Œä¿ç•™å®Œæ•´) === */
/* ... ä½ å¯ä»¥è²¼ä¸Šç¬¬ 4 éƒ¨åˆ†çš„ JS éŠæˆ²é‚è¼¯ ... */

/* ====== é¦–é é–‹å§‹ç•«é¢ + æ•™å­¸å¼•å° ====== */ 
const startScreen = document.getElementById("start-screen");
const guide = document.getElementById("guide");
const startBtn = document.getElementById("startBtn");
const skipBtn = document.getElementById("skipBtn");

// é»ã€Œé¦–é é–‹å§‹ã€ â†’ é¡¯ç¤ºæ•™å­¸å¼•å°
document.getElementById("start-btn").addEventListener("click", ()=>{
  startScreen.style.display = "none";
  guide.style.display = "flex";
});

// é»ã€Œé–‹å§‹éŠæˆ²ã€
startBtn.addEventListener("click", ()=>{
  guide.style.display = "none";
  startGame(); // âœ… å‘¼å«éŠæˆ²é–‹å§‹
});

// é»ã€Œç•¥éã€
skipBtn.addEventListener("click", ()=>{
  guide.style.display = "none";
  startGame();
});

// é» â“ â†’ å†æ‰“é–‹æ•™å­¸å¼•å°
document.getElementById("helpBtn").addEventListener("click", ()=>{
  guide.style.display = "flex";
});


</script>

<script>
/*=== èƒŒæ™¯ç²’å­ç‰¹æ•ˆ (ç¬¬ 5 éƒ¨åˆ†) === 
(function(){
  const canvas = document.getElementById('bg-canvas'); if(!canvas) return;
  const ctx = canvas.getContext('2d', { alpha:true });
  let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1);
  const styles=getComputedStyle(document.documentElement);
  const C1=(styles.getPropertyValue('--aurora-1')||'#00ffa3').trim();
  const C2=(styles.getPropertyValue('--aurora-2')||'#00d4ff').trim();
  const SYMBOLS = ['Â·','Â·','Â·','âœ§','âœ¦']; const COUNT=50; const SPEED=0.15; const ALPHA=0.1;
  const items=[];
  function rand(a,b){return a+Math.random()*(b-a)}; function pick(a){return a[Math.floor(Math.random()*a.length)]}
  function resize(){W=canvas.width=innerWidth*DPR;H=canvas.height=innerHeight*DPR;canvas.style.width=innerWidth+'px';canvas.style.height=innerHeight+'px'}
  function spawn(i){const sym=pick(SYMBOLS),isDot=(sym==='Â·');items[i]={sym,x:rand(0,W),y:rand(0,H),vx:rand(-SPEED,SPEED)*DPR,vy:rand(-SPEED,SPEED)*DPR,size:isDot?rand(1.5,2.5)*DPR:rand(12,18)*DPR,rot:rand(0,Math.PI*2),spin:rand(-0.002,0.002),alpha:ALPHA,color:Math.random()<0.5?C1:C2};}
  function wrap(o){if(o.x<-40)o.x=W+40;if(o.x>W+40)o.x=-40;if(o.y<-40)o.y=H+40;if(o.y>H+40)o.y=-40;}
  function step(){ctx.clearRect(0,0,W,H);items.forEach(o=>{o.x+=o.vx;o.y+=o.vy;o.rot+=o.spin;wrap(o);ctx.save();ctx.translate(o.x,o.y);ctx.rotate(o.rot);ctx.globalAlpha=o.alpha;if(o.sym==='Â·'){ctx.fillStyle=o.color;ctx.beginPath();ctx.arc(0,0,o.size,0,Math.PI*2);ctx.fill()}else{ctx.font=`${o.size}px system-ui,Apple Color Emoji`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=o.color;ctx.fillText(o.sym,0,0)}ctx.restore()});requestAnimationFrame(step);}
  resize();for(let i=0;i<COUNT;i++)spawn(i);requestAnimationFrame(step);addEventListener('resize',resize,{passive:true});
})();*/
</script>

<script>
/* ================== é—œå¡è¨­å®šï¼ˆSPMW ä¸€ç«™å¼ä¾›æ‡‰éˆä¸»ç·šï¼‰ ================== */
const LEVELS = [
  { name: 'SDG 13 â€” Climate Action',  size:4, time:60, targetMoves:40,
    desc:'Understand sustainable actions such as coping with extreme weather, promoting low-carbon transportation, and implementing home energy management.' },

  { name: 'SDG 10 â€” Reduced Inequalities', size:4, time:60, targetMoves:40,
    desc:'Recognize issues of social inequality, from vulnerable group care to the education gap, and explore methods for systemic improvement.' },

  { name: 'SDG 5 â€” Gender Equality', size:4, time:60, targetMoves:40,
    desc:'Learn to prevent stereotypes, uphold gender safety, and advocate for a friendly environment in schools and workplaces.' },

  { name: 'SDG 11 â€” Sustainable Cities', size:4, time:60, targetMoves:40,
    desc:'Navigate sustainability challenges in transportation, public spaces, recycling systems, and the development of smart cities.' },

  { name: 'SDG 12 â€” Responsible Consumption & Production', size:4, time:60, targetMoves:40,
    desc:'Cultivate sustainable consumer habits through plastic reduction, circularity, repair and reuse, and opposing excessive packaging.' },

  { name: 'SDG 17 â€” Partnerships for the Goals', size:4, time:60, targetMoves:40,
    desc:'Enhance skills in community involvement, media literacy, and fostering cross-sectoral collaboration for impactful change.' }
];

let LV = 0;


/* ================== å¡åº« ================== */
/* ================== SDGs æ•™è‚²å¡ç‰Œåº«ï¼ˆæ¯é—œå„ 8 å¼µï¼‰ ================== */
const ESG_ICONS = [
  /* ---- SDG 13: Climate Action ---- */
  {emoji:'ğŸŒ', label:'Extreme Weather', tip:'Global warming leads to increased heatwaves, droughts, and heavy rainfall.'},
  {emoji:'ğŸ”¥', label:'Summer Heatwaves', tip:'Urban heat island effect raises temperatures; green spaces are needed for cooling.'},
  {emoji:'ğŸš´', label:'Low-Carbon Transport', tip:'Walking, cycling, or public transit can reduce carbon emissions.'},
  {emoji:'ğŸŒ³', label:'Carbon Sink Trees', tip:'Increase trees and forests to absorb atmospheric CO2.'},
  {emoji:'ğŸ”Œ', label:'Household Energy Saving', tip:'Energy-efficient appliances and standby power cutoff lower energy use.'},
  {emoji:'ğŸŒ', label:'Renewable Energy', tip:'Utilize solar and wind power to replace fossil fuels.'},
  {emoji:'ğŸŒ§ï¸', label:'Flash Flooding', tip:'Extreme rainfall is becoming common; cities need improved drainage designs.'},
  {emoji:'ğŸ§Š', label:'Glacier Melting', tip:'Climate warming causes sea level rise, impacting coastal cities globally.'},

  /* ---- SDG 10: Reduced Inequalities ---- */
  {emoji:'ğŸ§“', label:'Elderly Care Needs', tip:'Rapid population aging accelerates the demand for care services.'},
  {emoji:'ğŸ§‘â€ğŸ¦½', label:'Accessible Spaces', tip:'Creating friendly roads, ramps, and elevators for universal mobility.'},
  {emoji:'ğŸ±', label:'Food Insecurity', tip:'Some vulnerable families face the issue of insufficient daily meals.'},
  {emoji:'ğŸ“š', label:'Education Gap', tip:'Disparities in urban and rural resources cause problems in the right to education.'},
  {emoji:'ğŸ’¼', label:'Employment Inequality', tip:'Different groups face gaps in wages and opportunities.'},
  {emoji:'ğŸ ', label:'Low-Income Families', tip:'Families with poor living conditions require social support systems.'},
  {emoji:'â¤ï¸', label:'Mental Well-being', tip:'Increased feelings of loneliness; society needs more psychological support.'},
  {emoji:'ğŸš¸', label:'Childcare Burden', tip:'Insufficient childcare services lead to increased family burden.'},

  /* ---- SDG 5: Gender Equality ---- */
  {emoji:'ğŸ‘©â€ğŸ”¬', label:'Women in STEM', tip:'Encouraging women to enter Science, Technology, Engineering, and Math fields.'},
  {emoji:'âš–ï¸', label:'Gender Pay Gap', tip:'The average salary for women is still lower than that for men.'},
  {emoji:'ğŸ§‘â€ğŸ¦°', label:'Workplace Stereotypes', tip:'Avoid pre-judging roles and capabilities based on gender.'},
  {emoji:'ğŸŒˆ', label:'Gender Diversity', tip:'Respect and support LGBTQ gender diversity.'},
  {emoji:'ğŸš«', label:'Harassment Prevention', tip:'Schools and workplaces require robust prevention mechanisms.'},
  {emoji:'ğŸ‘¶', label:'Parental Leave Imbalance', tip:'Child-rearing often falls to a single gender, creating inequality.'},
  {emoji:'ğŸ«', label:'Gender Education', tip:'Promoting accurate and comprehensive gender equality education.'},
  {emoji:'ğŸ§‘â€âš–ï¸', label:'Discrimination Incidents', tip:'Improve reporting rates and perfect the protection system.'},

  /* ---- SDG 11: Sustainable Cities & Communities ---- */
  {emoji:'ğŸš‡', label:'Public Transit Use', tip:'Improving convenience can reduce traffic congestion.'},
  {emoji:'ğŸ›»', label:'Traffic Congestion', tip:'Excessive vehicles in cities cause pollution and wasted time.'},
  {emoji:'ğŸ™ï¸', label:'Insufficient Green Space', tip:'Cities should increase parks and recreational areas.'},
  {emoji:'â™»ï¸', label:'Community Recycling', tip:'Proper sorting and recycling reduce overall waste volume.'},
  {emoji:'ğŸŒƒ', label:'Light Pollution', tip:'Excessive illumination impacts ecosystems and human sleep cycles.'},
  {emoji:'ğŸšš', label:'Logistics Efficiency', tip:'Improving transport efficiency reduces energy waste.'},
  {emoji:'ğŸ›œ', label:'Smart City Tech', tip:'Utilizing technology to improve traffic and energy usage.'},
  {emoji:'ğŸ“¦', label:'Waste Management', tip:'Efficient waste flow can increase recycling rates.'},

  /* ---- SDG 12: Responsible Consumption and Production ---- */
  {emoji:'ğŸ§´', label:'Plastic Reduction', tip:'Use reusable bags and cups to reduce single-use plastics.'},
  {emoji:'ğŸ¥¤', label:'Excessive Packaging', tip:'Choose minimalist packaging to reduce waste.'},
  {emoji:'ğŸ›', label:'Food Waste', tip:'Order appropriately and treasure food to minimize waste.'},
  {emoji:'ğŸ§µ', label:'Fast Fashion Issues', tip:'Low-cost clothing creates massive waste and pollution.'},
  {emoji:'ğŸ”§', label:'Repair Culture', tip:'Repairing old items is more sustainable than discarding them.'},
  {emoji:'ğŸ“¦', label:'Circular Packaging', tip:'Reusing packaging materials lowers resource consumption.'},
  {emoji:'ğŸ›ï¸', label:'Impulse Buying', tip:'Think before buying to ensure genuine need.'},
  {emoji:'ğŸ§ª', label:'Household Chemicals', tip:'Avoid overuse of cleaning agents to prevent water pollution.'},

  /* ---- SDG 17: Partnerships for the Goals ---- */
  {emoji:'ğŸ“¢', label:'Social Advocacy', tip:'Influence policy and society through public action.'},
  {emoji:'ğŸ—³ï¸', label:'Civic Voting', tip:'Actively participating in democratic mechanisms.'},
  {emoji:'ğŸ§­', label:'Media Literacy', tip:'Identifying misinformation to avoid being misled.'},
  {emoji:'ğŸ¤', label:'Cross-Sector Collaboration', tip:'Government, businesses, and civil society must partner for sustainability.'},
  {emoji:'ğŸ“¨', label:'Public Reporting', tip:'Using official channels to report community issues.'},
  {emoji:'ğŸ§©', label:'Community Volunteering', tip:'Participating in volunteer services to improve the community.'},
  {emoji:'ğŸ“', label:'Lifelong Learning', tip:'Continuously improving knowledge and skills.'},
  {emoji:'ğŸŒ', label:'Open Data Access', tip:'Utilizing public information to enhance transparency.'}
];

/* ================== DOM ================== */
const gridEl   = document.getElementById('grid');
const timeEl   = document.getElementById('time');
const timebar  = document.getElementById('timebar');
const movesEl  = document.getElementById('moves');
const matchEl  = document.getElementById('matches');
const pairsEl  = document.getElementById('pairs');
const toastEl  = document.getElementById('toast');
const overlay  = document.getElementById('overlay');
const resultTitle  = document.getElementById('resultTitle');
const resultText   = document.getElementById('resultText');
const playAgainBtn = document.getElementById('playAgainBtn');
const restartBtn   = document.getElementById('restartBtn');
const levelSel     = document.getElementById('levelSel');
const missionEl    = document.getElementById('mission');
const chipsEl      = document.getElementById('progressChips');
const unlockedEl   = document.getElementById('unlocked');
const needEl       = document.getElementById('need');
const knowEl       = document.getElementById('know');
const rankTable    = document.getElementById('rank').querySelector('tbody');
const nickInput    = document.getElementById('nick');
const saveBtn      = document.getElementById('saveScoreBtn');
const shareInput   = document.getElementById('shareUrl');
const copyBtn      = document.getElementById('copyBtn');

/* ================== ç‹€æ…‹ ================== */
let GRID_SIZE = LEVELS[LV].size;
let TIME_LIMIT = LEVELS[LV].time;
const FLIP_DELAY = 600;

let deck = [];
let first = null, second = null, lock = false;
let moves = 0, matched = 0, timer = null, timeLeft = TIME_LIMIT;
let discovered = new Set();
let lastRetentionScore = 0;  // âœ… æ–°å¢ï¼šæœ€å¾Œä¸€æ¬¡éŠæˆ²çš„è¨˜æ†¶ç•™å­˜åº¦åˆ†æ•¸


/* ================== å·¥å…· ================== */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }
function format(sec){ const m=Math.floor(sec/60).toString().padStart(2,'0'); const s=(sec%60).toString().padStart(2,'0'); return `${m}:${s}` }
function showToast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),1200); }
function showKnow(label){
  const icon = ESG_ICONS.find(x=>x.label===label);
  if(!icon) return;
  knowEl.innerHTML = `<strong>${icon.emoji} ${label}</strong>ï¼š${icon.tip}`;
  knowEl.style.display='block';
  setTimeout(()=>{ knowEl.style.display='none' }, 2600);
}

/* ================== ç‰Œçµ„ & ç‰ˆé¢ ================== */
function makeDeck(){
  const pairs = (GRID_SIZE * GRID_SIZE) / 2;
  
  // ğŸ§© ä¾é—œå¡é¸å–è©²éšæ®µçš„ 8 å¼µå¡
  const start = LV * 8;            // æ¯éšæ®µ 8 å¼µå¡
  const end   = start + 8;
  const stageCards = ESG_ICONS.slice(start, end);

  // å¾è©²éšæ®µ 8 å¼µå¡ä¸­å†æŠ½å‡ºéœ€è¦çš„é…å°æ•¸é‡
  const base = shuffle([...stageCards]).slice(0, pairs);

  // é›™ä»½åŒ–é…å°ä¸¦æ‰“äº‚
  const doubled = base.flatMap((it, idx) => [
    { ...it, id: idx + 'A' },
    { ...it, id: idx + 'B' }
  ]);

  return shuffle(doubled);
}

function renderGrid(){
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE},1fr)`;
  deck.forEach(card=>{
    const cell = document.createElement('div');
    cell.className='card';
    cell.dataset.key = card.id;
    cell.dataset.label = card.label;
    cell.innerHTML = `
      <div class="inner">
        <div class="face front" aria-hidden="true"></div>
        <div class="face back" role="img" aria-label="${card.label}">
          <div class="emoji">${card.emoji}</div>
          <div class="label">${card.label}</div>
        </div>
      </div>`;
    cell.addEventListener('click', onFlip);
    gridEl.appendChild(cell);
  });
}

/* ================== äº’å‹• ================== */
function onFlip(e){
  const el = e.currentTarget;
  if(lock || el.classList.contains('flipped') || el.classList.contains('matched')) return;
  el.classList.add('flipped');

  if(!first){ first = el; return; }
  second = el; lock = true; moves++; movesEl.textContent = moves;

  const same = first.dataset.label === second.dataset.label;
  if(same){
    setTimeout(()=>{
      first.classList.add('matched');
      second.classList.add('matched');
      matched++; matchEl.textContent = matched;

      const lab = first.dataset.label;
      discovered.add(lab); renderChips(); showToast(`Match Foundï¼š${lab}`); showKnow(lab);

      resetPick();
      if(matched === deck.length/2) endGame(true);
    }, 140);
  }else{
    setTimeout(()=>{ first.classList.remove('flipped'); second.classList.remove('flipped'); resetPick(); }, FLIP_DELAY);
  }
}
function resetPick(){ first=null; second=null; lock=false; }

/* ================== è¨ˆæ™‚ ================== */
function startTimer(){
  timeLeft = TIME_LIMIT;
  timeEl.textContent = format(timeLeft);
  timebar.style.width = '100%';
  if(timer) clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--;
    timeEl.textContent = format(timeLeft);
    timebar.style.width = Math.max(0,(timeLeft/TIME_LIMIT)*100)+'%';
    if(timeLeft<=0){ clearInterval(timer); endGame(false); }
  },1000);
}

/* ================== ä»»å‹™ / å°å¡é€²åº¦ ================== */
function renderMission(){ 
  const lv = LEVELS[LV];
  missionEl.textContent = `${lv.name}ï¼š${lv.desc}ï¼ˆFinish all pairs within the ${lv.time} s time limit; achieve a target score with ${lv.targetMoves} moves or less)`;
}

function updateStage(){
  const stageEl = document.getElementById('stageNow');
  if(stageEl) stageEl.textContent = LEVELS[LV].name;
}

function renderChips(){
  chipsEl.innerHTML = '';
  [...discovered].forEach(lab=>{
    const chip = document.createElement('span');
    chip.className='chip';
    const em = ESG_ICONS.find(x=>x.label===lab)?.emoji || 'â™»ï¸';
    chip.textContent = `${em} ${lab}`; chipsEl.appendChild(chip);
  });
  unlockedEl.textContent = discovered.size; needEl.textContent = (GRID_SIZE*GRID_SIZE)/2;
}

/* ================== é–‹å±€ / çµæŸ ================== */
function startGame(){
  levelSel.value = LV; // â­ å§‹çµ‚ä¿æŒé¸å–®é¡¯ç¤ºèˆ‡ LV ä¸€è‡´
  // âœ… æ¯æ¬¡é–‹å§‹æ–°é—œå¡éƒ½éš±è—åˆ†äº«èˆ‡æš±ç¨±å€
  document.querySelectorAll('.row').forEach(r => r.style.display = 'none');
  overlay.style.display='none';
  updateStage();
  const lv = LEVELS[LV]; GRID_SIZE=lv.size; TIME_LIMIT=lv.time;

  deck = makeDeck(); first=second=null; lock=false; moves=0; matched=0; discovered=new Set();
  movesEl.textContent='0'; matchEl.textContent='0'; pairsEl.textContent=(deck.length/2);
  renderGrid(); renderMission(); renderChips();

  document.querySelectorAll('.card').forEach(el=>el.classList.add('flipped'));
  setTimeout(()=>document.querySelectorAll('.card').forEach(el=>el.classList.remove('flipped')),700);
  startTimer();
}

/* ================== é€²å…¥ä¸‹ä¸€éšæ®µ ================== */
function nextStage(){
  LV++;
  if(LV >= LEVELS.length){
    showToast('ğŸ‰ You have completed the SDGs mission!');
    overlay.style.display = 'flex';
    resultTitle.textContent = 'All Stages Completed ğŸ¯';
    resultText.innerHTML = 'ğŸ‰ Congratulations! You have successfully mastered a portion of the relevant SDGs knowledge.';
    return;
  }
  showToast(`ğŸŒ Entering Next Stage:${LEVELS[LV].name}`);
  levelSel.value = LV;  // â­ æ–°å¢ï¼šæ›´æ–°é—œå¡é¸å–®é¡¯ç¤º
  setTimeout(()=>startGame(), 1000);
}

function endGame(win){
  lock = true;
  const timeUsed = TIME_LIMIT - timeLeft;
  const lv = LEVELS[LV];
  const pass = win && (moves <= lv.targetMoves);

  const resultTxt = win
    ? `<b>${LEVELS[LV].name}</b> complete!<br>${LEVELS[LV].desc}<br><br>You finished all matches in <b>${moves}</b> moves, taking <b>${format(timeUsed)}</b>ã€‚`
    : `You matched <b>${matched}</b> pairs; keep practicing!`;

      // âœ… æ–°å¢ï¼šè¨ˆç®—è¨˜æ†¶ç•™å­˜åº¦ï¼ˆåªåœ¨éé—œæ™‚è¨ˆç®—ï¼‰
  if (win) {
    const totalPairs = deck.length / 2;              // ç¸½é…å°çµ„æ•¸
    const efficiency = totalPairs / moves;           // é…å°æ•ˆç‡ï¼ˆ0~1ï¼‰
    lastRetentionScore = Math.round(efficiency * 100); // æ›æˆ 0~100 åˆ†
  }

  resultTitle.textContent = win ? 'Stage Complete ğŸ‰' : "Time's Up!";
  resultText.innerHTML = resultTxt;

    // âœ… æ–°å¢ï¼šæŠŠè¨˜æ†¶ç•™å­˜åº¦é¡¯ç¤ºçµ¦ç©å®¶ï¼ˆåªåœ¨éé—œæ™‚ï¼‰
  if (win) {
    resultText.innerHTML += `
      <br><br>
      <span style="font-size:14px;color:#0E63E6;">
        ğŸ“Š Memory Retention Score:<b>${lastRetentionScore}</b> points
        (Calculated based on "Matching Efficiency = Completed Pairs Ã· Steps")
      </span>
    `;
  }


  /* âœ… è‹¥éæœ€å¾Œä¸€é—œï¼Œå‡ºç¾ã€Œé–‹å§‹ä¸‹ä¸€é—œã€ */
  if (win && LV < LEVELS.length - 1) {
    resultText.innerHTML += `<br><br><button id="nextBtn" class="btn">Start Next Stage</button>`;
    setTimeout(() => {
      document.getElementById("nextBtn").addEventListener("click", () => {
        overlay.style.display = "none";
        nextStage(); // âœ… æ‰‹å‹•é€²å…¥ä¸‹ä¸€é—œ
      });
    }, 200);
  }

  /* âœ… è‹¥æ˜¯æœ€å¾Œä¸€é—œï¼Œæ‰é¡¯ç¤ºåˆ†äº«é€£çµèˆ‡æš±ç¨±è¼¸å…¥ */
  else if (win && LV === LEVELS.length - 1) {
    resultTitle.textContent = "Challenge Mastered ğŸ¯";
    resultText.innerHTML += `
      <br><br>You have successfully completed all four stage missions!
      <br><br>Enter your name and share your achievement link below ğŸ‘‡`;
    // âœ… é¡¯ç¤º overlay ä¸­çš„æš±ç¨±èˆ‡åˆ†äº«åˆ—
    document.querySelectorAll('.row').forEach(r => r.style.display = 'flex');
  } 
  else {
    // è‹¥å¤±æ•—éš±è—æš±ç¨±ã€åˆ†äº«å€
    document.querySelectorAll('.row').forEach(r => r.style.display = 'none');
  }

  // âœ… æ›´æ–°åˆ†äº«é€£çµ
  const url = new URL(window.location.href);
  url.searchParams.set("lv", String(LV));
  url.searchParams.set("size", String(GRID_SIZE));
  url.searchParams.set("moves", String(moves));
  url.searchParams.set("time", String(timeUsed));
  url.searchParams.set("ts", String(Date.now()));
  shareInput.value = url.toString();

  overlay.style.display = "flex";
}



/* ================== æ’è¡Œæ¦œï¼ˆæœ¬æ©Ÿï¼‰ ================== */
const STORE_KEY = 'esg_memory_leaderboard_v2';
function loadLB(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)||'[]') }catch{ return [] } }
function saveLB(list){ localStorage.setItem(STORE_KEY, JSON.stringify(list)) }
function pushScore(nick, lvIdx, size, timeUsed, moves){
  const list = loadLB();
  list.push({nick:nick||'â€”', level:LEVELS[lvIdx].name, size, timeUsed, moves, date:new Date().toLocaleDateString()});
  list.sort((a,b)=> a.timeUsed-b.timeUsed || a.moves-b.moves);
  saveLB(list.slice(0,10)); renderLB();
}
function renderLB(){
  const list = loadLB();
  rankTable.innerHTML = list.map((r,i)=>(
    `<tr><td>${i+1}</td><td>${escapeHtml(r.nick)}</td><td>${r.level}</td><td>${format(r.timeUsed)}</td><td>${r.moves}</td><td>${r.date}</td></tr>`
  )).join('');
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,(m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }

/* ================== äº‹ä»¶ ================== */
playAgainBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
levelSel.addEventListener('change', ()=>{ LV = Number(levelSel.value); startGame(); });
document.getElementById('saveScoreBtn').addEventListener('click', ()=>{
  const timeUsed = TIME_LIMIT - timeLeft;
  pushScore(nickInput.value.trim(), LV, GRID_SIZE, timeUsed>0?timeUsed:TIME_LIMIT, moves);
  showToast('Score successfully saved to Leaderboard!');
});
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(shareInput.value); showToast('Share link successfully copied!'); }
  catch{ shareInput.select(); document.execCommand('copy'); showToast('Copied to clipboard (Fallback)'); }
});

/* ================== å•Ÿå‹• ================== */
renderLB(); LV = 0; // âœ… ç¢ºä¿å¾ç¬¬ä¸€é—œé–‹å§‹ 
startGame();
(function readShare(){
  const u = new URL(window.location.href);
  const qMoves = u.searchParams.get('moves');
  const qTime  = u.searchParams.get('time');
  const qLv    = u.searchParams.get('lv');
  if(qMoves && qTime){ showToast(`Shared Result:${LEVELS[Number(qLv)||0].name} Score ${format(Number(qTime))}ï¼${qMoves} moves`) }
})();
</script>
<!-- ================== èƒŒæ™¯ç²’å­ ================== -->
<script>
(function(){
  const canvas = document.getElementById('bg-canvas'); 
  if(!canvas) return;
  const ctx = canvas.getContext('2d', { alpha:true });
  let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1);

  /* èª¿è‰²ï¼ˆè·Ÿ Aurora è‰²ç³»ä¸€è‡´ï¼‰ */
  const styles=getComputedStyle(document.documentElement);
  const C1=(styles.getPropertyValue('--aurora-1')||'#00ffa3').trim();
  const C2=(styles.getPropertyValue('--aurora-2')||'#00d4ff').trim();

  /* ç²’å­è¨­å®š */
  const SYMBOLS = ['Â·','Â·','Â·','âœ§','âœ¦']; // ä»¥å°é»ï¼‹æ˜Ÿå…‰ç‚ºä¸»
  const COUNT = Math.max(40, Math.min(90, Math.round((innerWidth*innerHeight)/28000)));
  const SPEED = 0.40;
  const ALPHA = 0.35;

  const items = [];
  function rand(a,b){ return a + Math.random()*(b-a) }
  function pick(a){ return a[Math.floor(Math.random()*a.length)] }

  function resize(){
    W = canvas.width  = Math.floor(innerWidth * DPR);
    H = canvas.height = Math.floor(innerHeight* DPR);
    canvas.style.width = innerWidth + 'px';
    canvas.style.height= innerHeight+ 'px';
  }

  function spawn(i=0){
    const sym = pick(SYMBOLS);
    const isDot = (sym==='Â·');
    items[i] = {
      sym, x: rand(0,W), y: rand(0,H),
      vx: rand(-SPEED,SPEED)*DPR, vy: rand(-SPEED*0.6,SPEED)*DPR,
      size: isDot ? rand(1.2,2.4)*DPR : rand(10,20)*DPR,
      rot: rand(0,Math.PI*2), spin: rand(-0.002,0.002),
      alpha: ALPHA, color: Math.random()<0.5?C1:C2
    };
  }

  function glow(hex, a){
    const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    if(!m) return `rgba(255,255,255,${a})`;
    const r=parseInt(m[1],16), g=parseInt(m[2],16), b=parseInt(m[3],16);
    return `rgba(${r},${g},${b},${a})`;
  }

  function wrap(o){ 
    if(o.x<-40)o.x=W+40; if(o.x>W+40)o.x=-40; 
    if(o.y<-40)o.y=H+40; if(o.y>H+40)o.y=-40; 
  }

  function step(){
    ctx.clearRect(0,0,W,H);

    // æŸ”å…‰æšˆï¼ˆAurora Glowï¼‰
    const g = ctx.createRadialGradient(W*0.25,H*0.25,0, W*0.25,H*0.25, Math.max(W,H)*0.6);
    g.addColorStop(0, glow(C2, .10)); g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

    items.forEach(o=>{
      o.x+=o.vx; o.y+=o.vy; o.rot+=o.spin; wrap(o);
      ctx.save(); ctx.translate(o.x,o.y); ctx.rotate(o.rot); ctx.globalAlpha=o.alpha;
      if(o.sym==='Â·'){ // dot
        ctx.fillStyle=o.color; ctx.beginPath(); ctx.arc(0,0,o.size,0,Math.PI*2); ctx.fill();
      }else{ // star
        ctx.font=`${o.size}px system-ui,Apple Color Emoji,Segoe UI Symbol`;
        ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillStyle=o.color; ctx.fillText(o.sym,0,0);
      }
      ctx.restore();
    });

    requestAnimationFrame(step);
  }

  resize(); for(let i=0;i<COUNT;i++) spawn(i); requestAnimationFrame(step);
  addEventListener('resize', resize, {passive:true});
})();
</script>

</body>
</html>
