<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å…±å¥½æ°¸çºŒå¡ï¼šè¡Œå‹•è§£æ–¹è¨˜æ†¶åº«</title>
<style>
  /* ====== è‰²ç¥¨ ====== */
:root{
  --ink:#1f2937;          /* æ·±ç°å¢¨è‰²ï¼šä¸€èˆ¬æ–‡å­—é¡è‰² */
  --muted:#64748b;        /* æ·ºç°è—å­—ï¼šæç¤ºæ–‡å­— */
  --line:rgba(0,0,0,.12); /* ç·šæ¢ï¼šåˆ†éš”ã€é‚Šæ¡† */

  --brand:#0E63E6;        /* ä¸»è—ï¼šä¸»è¦æŒ‰éˆ•/å¼·èª¿ */
  --brand-dark:#0A47A1;   /* æ·±è—ï¼šhover æˆ–æ¬¡è¦å¼·èª¿ */
  --ok:#20B386;           /* ç¶ è‰² (ok/æ­£å‘å¼·èª¿) */
  --bad:#ef4444;          /* éŒ¯èª¤ç´… */

  --card:#ffffff;         /* å¡ç‰‡ç™½åº• */
  --card-2:#f8fafc;       /* æ·ºç°è—å¡ç‰‡èƒŒæ™¯ */
  --bg:#f1f5f9;           /* é é¢æ•´é«”èƒŒæ™¯æ·ºç°è— */

  --aurora-1:#0E63E6;     /* è—å…‰ï¼ˆå°æ‡‰ä¸»è—ï¼‰ */
  --aurora-2:#38bdf8;     /* æ·ºè—å…‰ */
  --aurora-3:#20B386;     /* ç¶ å…‰ */
  --aurora-4:#94a3b8;     /* ç°å…‰ */
}

  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,"Noto Sans TC","Segoe UI",Roboto,Arial,sans-serif;}
  a{color:#7eead3;text-decoration:none} a:hover{text-decoration:underline}

  /* ====== èƒŒæ™¯å±¤ ====== */
  .bg-img{
    position:fixed; inset:0; z-index:0;
    background:url('background2.png') center/cover no-repeat;
    opacity:.35; filter:blur(2px);
  }
  .stage{
  position:fixed;
  inset:0;
  z-index:1;
  overflow:hidden;
  pointer-events:none;
  }

  /* âœ… é›²æœµ 1 */
  .cloud{
  position:absolute;
  top:10%;
  left:-200px;                         /* âœ… åˆå§‹ä½ç½®åœ¨è¢å¹•å¤– */
  width:180px;                         /* âœ… ä¿æŒåŸæœ¬å¤§å° */
  animation:moveCloud 40s linear infinite;
  }

  /* âœ… é›²æœµ 2 */
  .cloud2{
  position:absolute;
  top:20%;
  left:-200px;                         /* âœ… åˆå§‹ä½ç½®åœ¨è¢å¹•å¤– */
  width:140px;                         /* âœ… ä¿æŒåŸæœ¬å¤§å° */
  animation:moveCloud 60s linear infinite reverse;
  }
  
  /* âœ… è·‘å‹•å‹•ç•«ï¼ˆä¸ç”¨æ”¹ï¼‰ */
  @keyframes moveCloud{from{left:-200px}to{left:100%}}
  .windmill{position:absolute;left:6%;bottom:10%;width:160px;}
  .blade{animation:spin 8s linear infinite;transform-origin:50% 60%;}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  .trees{position:absolute;right:6%;bottom:8%;width:200px;}
  .bg{position:fixed; inset:0; z-index:1; pointer-events:none;}
  .blob{position:absolute; filter:blur(70px); opacity:.35; mix-blend-mode:screen;
    transform-origin:center center; animation:float 16s ease-in-out infinite alternate;}
  .b1{ width:55vw; height:55vw; left:-10vw; top:-12vh;
    background:radial-gradient(circle at 30% 30%, var(--aurora-1), transparent 55%); animation-duration:18s;}
  .b2{ width:60vw; height:60vw; right:-15vw; top:-6vh;
    background:radial-gradient(circle at 70% 20%, var(--aurora-2), transparent 55%); animation-duration:22s;}
  .b3{ width:50vw; height:50vw; left:10vw; bottom:-25vh;
    background:radial-gradient(circle at 40% 70%, var(--aurora-3), transparent 60%); animation-duration:20s;}
  .b4{ width:45vw; height:45vw; right:5vw; bottom:-20vh;
    background:radial-gradient(circle at 60% 60%, var(--aurora-4), transparent 60%); animation-duration:19s;}
  @keyframes float{0%{transform:translate3d(0,0,0) scale(1)}100%{transform:translate3d(2vw,-1.5vh,0) scale(1.05)}}
  #bg-canvas{position:fixed; inset:0; z-index:5; pointer-events:none;}

  /* ====== éŠæˆ²æ©Ÿå° ====== */
  .wrap{max-width:1100px;margin:20px auto;padding:0 16px;position:relative;z-index:2}
  header{display:flex;gap:16px;align-items:center;flex-wrap:wrap;justify-content:space-between;margin-bottom:12px}
  h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.2px}
  .meta{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

.pill{
  background:var(--card-2);           /* æ·ºç°è—åº• */
  border:1px solid var(--line);
  border-radius:999px;                /* ä¿æŒè† å›Šå½¢ç‹€ */
  padding:6px 12px;
  font-size:14px;
  color:var(--ink);                   /* æ·±ç°å­— */
}

 .select{
  appearance:none;
  background:var(--card-2);            /* âœ… èƒŒæ™¯æ”¹å¡ç‰‡æ·ºç°è— */
  color:var(--ink);                    /* âœ… æ–‡å­—ç”¨æ·±ç°å¢¨è‰² */
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 10px;
  font-size:14px;
}

.btn{
  background:linear-gradient(135deg,var(--brand),var(--brand-dark));  /* âœ… æ”¹æˆä¸»è—+æ·±è— */
  color:#fff;                               /* âœ… æŒ‰éˆ•æ–‡å­—æ”¹ç™½ */
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 22px rgba(14,99,230,.25); /* âœ… æ”¹æˆä¸»è—é™°å½± */
}

  .btn:hover{filter:brightness(1.05)}
  .bar{
  height:10px;
  background:var(--card-2);                 /* âœ… èƒŒæ™¯æ·ºç°è— */
  border-radius:999px;
  overflow:hidden;
  border:1px solid var(--line);
}
.bar>span{
  display:block;height:100%;width:100%;
  background:linear-gradient(90deg,var(--ok),#38bdf8);  /* âœ… ç¶ è‰²åˆ°æ·ºè—è‰² */
}

  .panel{display:grid;grid-template-columns:1fr 320px;gap:16px}
  @media (max-width:1024px){.panel{grid-template-columns:1fr}}
  .grid{display:grid;gap:10px;margin-top:14px}
  .side{
  background:var(--card-2);                 /* âœ… å´é‚Šæ¬„èƒŒæ™¯æ”¹æ·ºç°è— */
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  backdrop-filter:blur(8px);
}
.side h3{color:var(--brand);}              /* âœ… æ¨™é¡Œæ–‡å­—ç”¨ä¸»è— */
.tip{font-size:13px;color:var(--muted);}   /* âœ… å·²ç”¨ muted æ·ºç°è—ï¼Œä¸éœ€é¡å¤–æ”¹ */
.kv{font-size:13px;color:var(--muted);}


  /* ====== å¡ç‰‡ ====== */
  .card{position:relative;aspect-ratio:1/1;perspective:1200px;cursor:pointer;user-select:none}
  .inner{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .28s ease}
  .card.flipped .inner,.card.matched .inner{transform:rotateY(180deg)}
  .face{position:absolute;inset:0;border-radius:14px;display:flex;align-items:center;
    justify-content:center;backface-visibility:hidden;overflow:hidden}
  .front{
  background:var(--card-2);                 /* âœ… èƒŒæ™¯æ·ºç°è— */
  border:1px solid var(--line);
}
.back{
  transform:rotateY(180deg);
  background:var(--card);                   /* âœ… èƒŒæ™¯ç™½åº• */
  border:1px solid var(--line);
}
.emoji{font-size:38px;line-height:1}
.label{
  position:absolute;bottom:10px;left:0;right:0;
  text-align:center;font-size:12px;
  color:var(--muted);                       /* âœ… æ–‡å­—é¡è‰²æ”¹æˆ muted ç°è— */
}


  /* ====== å…¶ä»– UI ====== */
  .chips{display:flex;flex-wrap:wrap;gap:6px}
  .chip{
  background:rgba(14,99,230,.14);           /* âœ… æ”¹æˆè—è‰²é€æ˜åº• */
  border:1px solid rgba(14,99,230,.35);     /* âœ… è—è‰²é‚Šæ¡† */
  color:var(--brand-dark);                  /* âœ… æ–‡å­—é¡è‰²ç”¨æ·±è— */
  font-size:12px;border-radius:999px;padding:4px 8px
}

.toast{
  position:fixed;              /* âœ… å›ºå®šå®šä½ */
  left:50%;                    /* âœ… æ°´å¹³ç½®ä¸­ */
  bottom:24px;                 /* âœ… åº•éƒ¨ä½ç½® */
  transform:translateX(-50%);  /* âœ… ä¿æŒæ­£ä¸­ */
  background:var(--card);      /* âœ… ç™½åº• */
  color:var(--ink);            /* âœ… æ·±ç°å­— */
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 14px;
  font-size:14px;
  opacity:0;
  transition:opacity .2s,transform .2s;
  z-index:5;
  box-shadow:0 4px 12px rgba(0,0,0,.1);  /* âœ… å’Œ .know ä¸€è‡´çš„æµ®å‡ºæ„Ÿ */
}


  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
  .overlay{position:fixed;inset:0;background:rgba(2,8,14,.7);display:none;
    align-items:center;justify-content:center;padding:16px;z-index:10;backdrop-filter:blur(4px)}
  .dialog{
  background:var(--card);                   /* âœ… å°è©±æ¡†ç™½åº• */
  color:var(--ink);                         /* âœ… æ–‡å­—æ·±ç°å¢¨è‰² */
  border-radius:16px;
  max-width:560px;width:100%;padding:20px;
  text-align:center;
  border:1px solid var(--line);
}

  .dialog h2{margin:0 0 8px}
  .row{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap}
  .input{
  width:240px;
  background:var(--card-2);                 /* âœ… æ·ºç°è—åº• */
  color:var(--ink);                         /* âœ… æ·±ç°å­— */
  border:1px solid var(--line);
  border-radius:10px;
  padding:9px 10px;
}

  table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 6px;
  font-size:13px;
  color:var(--ink);                         /* âœ… è¡¨æ ¼å­—é¡è‰²æ·±ç° */
}
tr{background:var(--card-2);border:1px solid var(--line);}  /* âœ… åˆ—èƒŒæ™¯æ·ºç°è— */

.know{
  position:fixed;                /* âœ… å›ºå®šå®šä½ */
  left:50%;                      /* âœ… æ°´å¹³ç½®ä¸­ */
  bottom:88px;                   /* âœ… åº•éƒ¨æµ®å‡ºä½ç½® */
  transform:translateX(-50%);    /* âœ… å‘å·¦ç§»åŠå¯¬ä¿æŒæ­£ä¸­ */
  background:var(--card);        /* âœ… æ·ºè‰²ç™½åº• */
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px 14px;
  display:none;
  max-width:560px;
  width:calc(100% - 32px);
  z-index:9;                     /* âœ… æµ®åœ¨æœ€ä¸Šå±¤ */
  color:var(--ink);              /* âœ… ä¸»æ–‡å­—æ·±ç° */
  box-shadow:0 4px 12px rgba(0,0,0,.1);  /* âœ… æ·ºè‰²åº•éœ€è¦é™°å½±ä¾†å‡¸é¡¯ */
}
.know strong{
  color:var(--brand);            /* âœ… å¼·èª¿å­—æ”¹æˆä¸»è— */
}

#helpBtn{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  color:var(--brand);         /* âœ… ä¸»è—è‰² */
}
#helpBtn:hover{color:var(--brand-dark);}


/* ====== æ•™å­¸å¼•å°æ¡† ====== */
.guide{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);       /* åŠé€æ˜é»‘èƒŒæ™¯ */
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.guide-card{
  background:var(--card);          /* ç™½åº•ï¼ˆç”¨ä½ çš„è‰²ç¥¨ï¼‰ */
  color:var(--ink);
  border-radius:16px;
  padding:20px;
  max-width:420px;
  width:calc(100% - 40px);
  box-shadow:0 8px 24px rgba(0,0,0,.15);
  text-align:left;
}
.guide-card h2{color:var(--brand);}
.steps{margin:14px 0;display:grid;gap:10px;font-size:14px;color:var(--ink);}
.step b{font-size:18px;margin-right:6px;}
.guide-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px;}
.icon-btn{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:14px;
}


/* ====== é–‹å§‹ç•«é¢ ====== */

.overlay-start{
  position:fixed;
  inset:0;
  /*background:var(--bg);*/
  background:url('home1.1.png') center/cover no-repeat; 
  background-color:#0E63E6; 
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:50; /* âœ… ä¿è­‰æœ€ä¸Šå±¤ */
}
.start-box{
  background:var(--card);
  padding:30px 40px;
  border-radius:16px;
  text-align:center;
  box-shadow:0 6px 18px rgba(0,0,0,.2);

  /* âœ… å…ˆåšæ·¡å…¥ï¼Œå†æ¥å½ˆè·³ */
  animation: fadeIn 0.8s ease-out, bounce 1.6s 0.8s infinite;
  transform-origin: center bottom;
}

/* âœ… æ·¡å…¥å‹•ç•« */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to   { opacity: 1; transform: scale(1); }
}

/* âœ… è·³å‹•å‹•ç•« */
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-18px);
  }
  60% {
    transform: translateY(-10px);
  }
}


.start-box h1{margin:0 0 16px;color:var(--brand);}
.start-box p{margin:0 0 20px;color:var(--muted);}
.start-box button{
  background:linear-gradient(135deg,var(--brand),var(--brand-dark));
  color:#fff;
  border:none;
  border-radius:10px;
  padding:12px 20px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}  

/* ====== æ•™å­¸æ¡† ====== */
.overlay-tutorial{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none; /* âœ… é è¨­éš±è— */
  align-items:center;
  justify-content:center;
  z-index:40;
}
.tutorial-box{
  background:var(--card);
  padding:24px 28px;
  border-radius:16px;
  text-align:center;
  max-width:420px;
  color:var(--ink);
  box-shadow:0 6px 20px rgba(0,0,0,.25);
}
.tutorial-box h2{margin:0 0 12px;color:var(--brand);}
.tutorial-box p{margin:0 0 20px;}
.tutorial-box button{
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  font-size:14px;
  cursor:pointer;
}

/* --- æ–°å¢çš„èªè¨€åˆ‡æ›æŒ‰éˆ•æ¨£å¼ --- */

/* 1. ç”¨æ–¼ã€Œé–‹å§‹ç•«é¢ã€çš„æŒ‰éˆ• */
.lang-switch-btn {
  display: block; /* è®“å®ƒç¨ä½”ä¸€è¡Œ */
  width: -moz-fit-content; /* èˆŠç‰ˆ Firefox */
  width: fit-content; /* å…§å®¹è‡ªé©æ‡‰å¯¬åº¦ */
  margin: 0 auto 16px auto; /* æ°´å¹³ç½®ä¸­ã€ä¸‹æ–¹é–“è· 16px */
  background: var(--card-2);  /* æ·ºç°è—åº• */
  color: var(--muted);       /* æ·ºç°è—å­— */
  border: 1px solid var(--line);
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 14px;
  text-decoration: none;
  transition: background .2s;
}
.lang-switch-btn:hover {
  background: var(--bg); /* æ‡¸åœæ™‚è®Šè‰² */
  color: var(--ink);
  text-decoration: none;
}

/* 2. ç”¨æ–¼ã€Œæ•™å­¸æ¡†ã€çš„æŒ‰éˆ• (é å·¦) */
.guide-actions a.icon-btn {
  text-decoration: none;
  margin-right: auto; /* é—œéµï¼šæŠŠå®ƒæ¨åˆ°æœ€å·¦é‚Š */
}

/* 3. ç”¨æ–¼ã€ŒéŠæˆ²æ¨™é ­ã€çš„æŒ‰éˆ• (ç¢ºä¿ a.pill æ²’åº•ç·š) */
header .meta a.pill {
  text-decoration: none;
}
header .meta a.pill:hover {
  background: var(--card);
  text-decoration: none;
}
/* --- æ¨£å¼æ–°å¢çµæŸ --- */

</style>
</head>

<body>
<!-- ====== é–‹å§‹ç•«é¢ ====== -->
<div id="start-screen" class="overlay-start">
  <div class="start-box">
  <h1>SDGs è¨˜æ†¶é…å°éŠæˆ²</h1>
  <p>å¿«ä¾†æŒ‘æˆ°ï¼é…å°å¡ç‰‡ï¼Œå­¸ç¿’æ°¸çºŒçŸ¥è­˜ ğŸŒ±</p>
  <a href="card2.html" class="lang-switch-btn">Switch to English</a>
  <button id="start-btn">é–‹å§‹éŠæˆ²</button>
</div>
</div>

<!-- ====== æ•™å­¸æ¡† ====== -->
<!-- æ•™å­¸å¼•å°ï¼ˆé¦–æ¬¡é¡¯ç¤ºï¼Œä¹Ÿå¯é»â“å†é–‹ï¼‰ -->
<div class="guide" id="guide">
  <div class="guide-card">
    <h2 style="margin:0 0 6px">éŠæˆ²æ“ä½œæ•™å­¸</h2>
    <div class="tip" style="color:#246084">3 æ­¥é©Ÿå¿«é€Ÿä¸Šæ‰‹</div>
    <div class="steps">
      <div class="step"><b>ğŸ–±ï¸</b><strong>1ï¼‰é»å…©å¼µå¡</strong><br>è‹¥åœ–ç¤ºç›¸åŒå³é…å°æˆåŠŸã€‚</div>
      <div class="step"><b>â±ï¸</b><strong>2ï¼‰æŠŠæ¡æ™‚é–“</strong><br>åœ¨é™æ™‚å…§å®Œæˆæ‰€æœ‰é…å°ã€‚</div>
      <div class="step"><b>ğŸ¯</b><strong>3ï¼‰è§£é–å°å¡</strong><br>æ¯æ¬¡é…å°æœƒè·³å‡º SDGs å°çŸ¥è­˜ã€‚</div>
    </div>
    <div class="guide-actions">
      <a href="card2.html" class="icon-btn">English</a>
      
      <button class="btn" id="startBtn">æŒ‘æˆ°é–‹å§‹</button>
      <button class="icon-btn" id="skipBtn">ç•¥é</button>
    </div>
  </div>
</div>

<!-- èƒŒæ™¯ -->
<div class="bg-img"></div>
<div class="stage">
    <img src="cloud.png" class="cloud">
    <img src="cloud1.png" class="cloud2">
<!-- âœ… é¢¨è»Š -->
    <svg class="windmill" viewBox="0 0 200 200">
      <!-- âœ… æ¼¸å±¤å®šç¾© -->
      <defs>
        <linearGradient id="bladeGradient" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#7FC0FF"/>
          <stop offset="100%" stop-color="#0E63E6"/>
        </linearGradient>
      </defs>

      <!-- âœ… ä¸­å¿ƒåœ“ -->
      <circle cx="100" cy="120" r="14" fill="#fff" stroke="#555" stroke-width="3"/>

      <!-- âœ… è‘‰ç‰‡ï¼ˆåŠ äº†åœ“è§’ rx/ryï¼‰ -->
      <g class="blade">
        <rect x="92" y="10" width="16" height="100" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="92" y="120" width="16" height="70" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="30" y="112" width="70" height="16" rx="6" ry="6" fill="url(#bladeGradient)"/>
        <rect x="100" y="112" width="70" height="16" rx="6" ry="6" fill="url(#bladeGradient)"/>
      </g>
    </svg>
  <svg class="trees" viewBox="0 0 200 200">
    <circle cx="60" cy="140" r="40" fill="#C9F0DD" stroke="#6aa787" stroke-width="4"/>
    <circle cx="140" cy="160" r="30" fill="#D6F6E6" stroke="#6aa787" stroke-width="4"/>
  </svg>
</div>
<div class="bg">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <div class="blob b4"></div>
</div>
  <canvas id="bg-canvas"></canvas>

<!-- éŠæˆ²æ©Ÿå° -->
<div class="wrap">
  <header>
    <h1>å…±å¥½æ°¸çºŒå¡ï¼šè¡Œå‹•è§£æ–¹è¨˜æ†¶åº«</h1>
    <div class="meta">
      <select id="levelSel" class="select">
        <option value="0">SDG13 â€” æ°£å€™è®Šé·èˆ‡èƒ½æº </option>
        <option value="1">SDG10 â€” ç¤¾æœƒå…¬å¹³èˆ‡å¼±å‹¢ </option>
        <option value="2">SDG5 â€” æ€§åˆ¥å¹³ç­‰ </option>
        <option value="3">SDG11 â€” æ°¸çºŒåŸå¸‚ </option>
        <option value="4">SDG12 â€” è²¬ä»»æ¶ˆè²»èˆ‡ç”Ÿç”¢ </option>
        <option value="5">SDG17 â€” å…¬æ°‘åƒèˆ‡èˆ‡åˆä½œ </option>
      </select>
      <a href="card2.html" class="pill">English</a>
      <div class="pill">æ™‚é–“ï¼š<b id="time">--</b></div>
      <div class="pill">æ­¥æ•¸ï¼š<b id="moves">0</b></div>
      <div class="pill">é…å°ï¼š<b id="matches">0</b>/<b id="pairs">--</b></div>
      <button class="btn" id="restartBtn">é‡æ–°é–‹å§‹</button>
      <button class="icon-btn" id="helpBtn">â“</button>
    </div>
  </header>
  <div class="bar"><span id="timebar"></span></div>
  <div class="panel">
    <div><div id="grid" class="grid"></div><div id="know" class="know"></div></div>
    <aside class="side">
      <h3>ä»»å‹™ / é€²åº¦</h3>
      <div id="mission" class="tip"></div>
      <div class="chips" id="progressChips"></div>
      <div class="tip">å·²è§£é–å°å¡ï¼š<b id="unlocked">0</b>/<b id="need">--</b></div>
      <hr>
      <h3>SDGsé—œå¡é€²åº¦</h3>
      <div class="tip">ç›®å‰é—œå¡ï¼š<b id="stageNow">--</b></div>
      <hr><h3>æ’è¡Œæ¦œï¼ˆæœ¬æ©Ÿï¼‰</h3>
      <table id="rank"><thead><tr><th>#</th><th>æš±ç¨±</th><th>é—œå¡</th><th>æ™‚é–“</th><th>æ­¥æ•¸</th><th>æ—¥æœŸ</th></tr></thead><tbody></tbody></table>
    </aside>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="overlay" id="overlay">
  <div class="dialog">
    <h2 id="resultTitle">æ™‚é–“åˆ°ï¼</h2>
    <p id="resultText"></p>
    <div class="row"><input id="nick" class="input" placeholder="æš±ç¨±"><button class="btn" id="saveScoreBtn">å„²å­˜</button></div>
    <div class="row"><input id="shareUrl" class="input" readonly><button class="btn" id="copyBtn">è¤‡è£½</button></div>
    <div class="row"><button class="btn" id="playAgainBtn">å†ä¾†ä¸€å±€</button></div>
  </div>
</div>

<script>
/* === JS éŠæˆ²é‚è¼¯ (ç•¥ï¼Œè·Ÿä¹‹å‰ç›¸åŒï¼Œä¿ç•™å®Œæ•´) === */
/* ... ä½ å¯ä»¥è²¼ä¸Šç¬¬ 4 éƒ¨åˆ†çš„ JS éŠæˆ²é‚è¼¯ ... */

/* ====== é¦–é é–‹å§‹ç•«é¢ + æ•™å­¸å¼•å° ====== */ 
const startScreen = document.getElementById("start-screen");
const guide = document.getElementById("guide");
const startBtn = document.getElementById("startBtn");
const skipBtn = document.getElementById("skipBtn");

// é»ã€Œé¦–é é–‹å§‹ã€ â†’ é¡¯ç¤ºæ•™å­¸å¼•å°
document.getElementById("start-btn").addEventListener("click", ()=>{
  startScreen.style.display = "none";
  guide.style.display = "flex";
});

// é»ã€Œé–‹å§‹éŠæˆ²ã€
startBtn.addEventListener("click", ()=>{
  guide.style.display = "none";
  startGame(); // âœ… å‘¼å«éŠæˆ²é–‹å§‹
});

// é»ã€Œç•¥éã€
skipBtn.addEventListener("click", ()=>{
  guide.style.display = "none";
  startGame();
});

// é» â“ â†’ å†æ‰“é–‹æ•™å­¸å¼•å°
document.getElementById("helpBtn").addEventListener("click", ()=>{
  guide.style.display = "flex";
});


</script>

<script>
/*=== èƒŒæ™¯ç²’å­ç‰¹æ•ˆ (ç¬¬ 5 éƒ¨åˆ†) === 
(function(){
  const canvas = document.getElementById('bg-canvas'); if(!canvas) return;
  const ctx = canvas.getContext('2d', { alpha:true });
  let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1);
  const styles=getComputedStyle(document.documentElement);
  const C1=(styles.getPropertyValue('--aurora-1')||'#00ffa3').trim();
  const C2=(styles.getPropertyValue('--aurora-2')||'#00d4ff').trim();
  const SYMBOLS = ['Â·','Â·','Â·','âœ§','âœ¦']; const COUNT=50; const SPEED=0.15; const ALPHA=0.1;
  const items=[];
  function rand(a,b){return a+Math.random()*(b-a)}; function pick(a){return a[Math.floor(Math.random()*a.length)]}
  function resize(){W=canvas.width=innerWidth*DPR;H=canvas.height=innerHeight*DPR;canvas.style.width=innerWidth+'px';canvas.style.height=innerHeight+'px'}
  function spawn(i){const sym=pick(SYMBOLS),isDot=(sym==='Â·');items[i]={sym,x:rand(0,W),y:rand(0,H),vx:rand(-SPEED,SPEED)*DPR,vy:rand(-SPEED,SPEED)*DPR,size:isDot?rand(1.5,2.5)*DPR:rand(12,18)*DPR,rot:rand(0,Math.PI*2),spin:rand(-0.002,0.002),alpha:ALPHA,color:Math.random()<0.5?C1:C2};}
  function wrap(o){if(o.x<-40)o.x=W+40;if(o.x>W+40)o.x=-40;if(o.y<-40)o.y=H+40;if(o.y>H+40)o.y=-40;}
  function step(){ctx.clearRect(0,0,W,H);items.forEach(o=>{o.x+=o.vx;o.y+=o.vy;o.rot+=o.spin;wrap(o);ctx.save();ctx.translate(o.x,o.y);ctx.rotate(o.rot);ctx.globalAlpha=o.alpha;if(o.sym==='Â·'){ctx.fillStyle=o.color;ctx.beginPath();ctx.arc(0,0,o.size,0,Math.PI*2);ctx.fill()}else{ctx.font=`${o.size}px system-ui,Apple Color Emoji`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=o.color;ctx.fillText(o.sym,0,0)}ctx.restore()});requestAnimationFrame(step);}
  resize();for(let i=0;i<COUNT;i++)spawn(i);requestAnimationFrame(step);addEventListener('resize',resize,{passive:true});
})();*/
</script>

<script>
/* ================== å…­å¤§æ°¸çºŒè­°é¡Œé—œå¡è¨­å®šï¼ˆSDGs ä¸»é¡Œï¼‰ ================== */
const LEVELS = [
  { name: 'SDG13 â€” æ°£å€™è®Šé·èˆ‡èƒ½æº',  size:4, time:60, targetMoves:40,
    desc:'äº†è§£æ¥µç«¯æ°£å€™ã€ä½ç¢³äº¤é€šèˆ‡å®¶åº­èƒ½æºç®¡ç†ç­‰æ°¸çºŒè¡Œå‹•ã€‚' },

  { name: 'SDG10 â€” ç¤¾æœƒå…¬å¹³èˆ‡å¼±å‹¢', size:4, time:60, targetMoves:40,
    desc:'å¾å¼±å‹¢ç…§è­·åˆ°æ•™è‚²è½å·®ï¼Œèªè­˜ç¤¾æœƒä¸å¹³ç­‰å•é¡Œèˆ‡æ”¹å–„æ–¹æ³•ã€‚' },

  { name: 'SDG5 â€” æ€§åˆ¥å¹³ç­‰', size:4, time:60, targetMoves:40,
    desc:'é¿å…åˆ»æ¿å°è±¡ã€ç¶­è­·æ€§åˆ¥å®‰å…¨ä¸¦æ¨å‹•å‹å–„æ ¡åœ’èˆ‡è·å ´ã€‚' },

  { name: 'SDG11 â€” æ°¸çºŒåŸå¸‚', size:4, time:60, targetMoves:40,
    desc:'äº¤é€šã€å…¬å…±ç©ºé–“ã€å›æ”¶ç³»çµ±åˆ°æ™ºæ…§åŸå¸‚çš„æ°¸çºŒæŒ‘æˆ°ã€‚' },

  { name: 'SDG12 â€” è²¬ä»»æ¶ˆè²»èˆ‡ç”Ÿç”¢', size:4, time:60, targetMoves:40,
    desc:'æ¸›å¡‘ã€å¾ªç’°ã€ä¿®è£œèˆ‡å»éåº¦åŒ…è£ï¼ŒåŸ¹é¤Šæ°¸çºŒæ¶ˆè²»è§€å¿µã€‚' },

  { name: 'SDG17 â€” å…¬æ°‘åƒèˆ‡èˆ‡åˆä½œ', size:4, time:60, targetMoves:40,
    desc:'æå‡ç¤¾å€åƒèˆ‡ã€åª’é«”è­˜è®€èˆ‡è·¨éƒ¨é–€åˆä½œèƒ½åŠ›ã€‚' }
];

let LV = 0;


/* ================== å¡åº« ================== */
/* ================== SDGs æ•™è‚²å¡ç‰Œåº«ï¼ˆæ¯é—œå„ 8 å¼µï¼‰ ================== */
const ESG_ICONS = [
  /* ---- SDG13ï¼šæ°£å€™è®Šé· ---- */
  {emoji:'ğŸŒ', label:'æ¥µç«¯æ°£å€™', tip:'å…¨çƒæš–åŒ–é€ æˆç†±æµªã€ä¹¾æ—±èˆ‡æš´é›¨å¢åŠ ã€‚'},
  {emoji:'ğŸ”¥', label:'å¤å­£ç†±æµª', tip:'åŸå¸‚ç†±å³¶æ•ˆæ‡‰è®“æ°£æº«æ›´é«˜ï¼Œéœ€è¦ç¶ åœ°é™æº«ã€‚'},
  {emoji:'ğŸš´', label:'ä½ç¢³äº¤é€š', tip:'æ­¥è¡Œã€é¨è»Šã€æ­ä¹˜å¤§çœ¾é‹è¼¸å¯æ¸›å°‘ç¢³æ’ã€‚'},
  {emoji:'ğŸŒ³', label:'ç¢³åŒ¯æ¨¹æœ¨', tip:'å¢åŠ æ¨¹æœ¨èˆ‡æ£®æ—å¸æ”¶äºŒæ°§åŒ–ç¢³ã€‚'},
  {emoji:'ğŸ”Œ', label:'å®¶åº­ç¯€èƒ½', tip:'ç¯€èƒ½å®¶é›»èˆ‡å¾…æ©Ÿæ–·é›»å¯é™ä½èƒ½æºä½¿ç”¨ã€‚'},
  {emoji:'ğŸŒ', label:'å†ç”Ÿèƒ½æº', tip:'å¤ªé™½èƒ½ã€é¢¨èƒ½æ›¿ä»£åŒ–çŸ³ç‡ƒæ–™ã€‚'},
  {emoji:'ğŸŒ§ï¸', label:'æš´é›¨æ·¹æ°´', tip:'æ¥µç«¯é™é›¨æ›´å¸¸è¦‹ï¼ŒåŸå¸‚éœ€æå‡æ’æ°´è¨­è¨ˆã€‚'},
  {emoji:'ğŸ§Š', label:'å†°å·èåŒ–', tip:'æ°£å€™æš–åŒ–å°è‡´æµ·å¹³é¢ä¸Šå‡ï¼Œå½±éŸ¿å…¨çƒæ²¿å²¸åŸå¸‚ã€‚'},

  /* ---- SDG10ï¼šç¤¾æœƒå…¬å¹³ ---- */
  {emoji:'ğŸ§“', label:'é«˜é½¡ç…§è­·', tip:'äººå£è€åŒ–åŠ åŠ‡ï¼Œç…§è­·éœ€æ±‚å¿«é€Ÿä¸Šå‡ã€‚'},
  {emoji:'ğŸ§‘â€ğŸ¦½', label:'ç„¡éšœç¤™ç©ºé–“', tip:'æ‰“é€ å‹å–„é“è·¯ã€å¡é“ã€é›»æ¢¯è®“äººäººå¯è¡Œå‹•ã€‚'},
  {emoji:'ğŸ±', label:'é£Ÿç‰©ä¸å®‰å…¨', tip:'éƒ¨åˆ†å¼±å‹¢å®¶åº­é¢è‡¨ä¸‰é¤ä¸è¶³å•é¡Œã€‚'},
  {emoji:'ğŸ“š', label:'æ•™è‚²è½å·®', tip:'åŸé„‰è³‡æºä¸å‡é€ æˆå—æ•™æ¬Šå•é¡Œã€‚'},
  {emoji:'ğŸ’¼', label:'å°±æ¥­ä¸å¹³ç­‰', tip:'ä¸åŒæ—ç¾¤é¢è‡¨è–ªè³‡ã€æ©Ÿæœƒå·®è·ã€‚'},
  {emoji:'ğŸ ', label:'ä½æ”¶å…¥å®¶åº­', tip:'ç”Ÿæ´»æ¢ä»¶è¼ƒå·®ï¼Œéœ€è¦ç¤¾æœƒæ”¯æŒç³»çµ±ã€‚'},
  {emoji:'â¤ï¸', label:'å¿ƒç†å¥åº·', tip:'å­¤ç¨æ„Ÿå¢åŠ ï¼Œç¤¾æœƒéœ€æ›´å¤šå¿ƒç†æ”¯æŒã€‚'},
  {emoji:'ğŸš¸', label:'å…’å°‘æ‰˜è‚²', tip:'æ‰˜è‚²ä¸è¶³é€ æˆå®¶åº­è² æ“”åŠ é‡ã€‚'},

  /* ---- SDG5ï¼šæ€§åˆ¥å¹³ç­‰ ---- */
  {emoji:'ğŸ‘©â€ğŸ”¬', label:'å¥³æ€§ STEM', tip:'é¼“å‹µå¥³æ€§æŠ•å…¥ç§‘å­¸ã€å·¥ç¨‹èˆ‡ç§‘æŠ€é ˜åŸŸã€‚'},
  {emoji:'âš–ï¸', label:'æ€§åˆ¥è–ªè³‡å·®è·', tip:'å¥³æ€§å¹³å‡è–ªè³‡ä»ä½æ–¼ç”·æ€§ã€‚'},
  {emoji:'ğŸ§‘â€ğŸ¦°', label:'è·å ´åˆ»æ¿å°è±¡', tip:'é¿å…ä»¥æ€§åˆ¥é è¨­è§’è‰²èˆ‡èƒ½åŠ›ã€‚'},
  {emoji:'ğŸŒˆ', label:'å¤šå…ƒæ€§åˆ¥', tip:'å°Šé‡ä¸¦æ”¯æŒ LGBTQ+ æ€§åˆ¥å¤šæ¨£æ€§ã€‚'},
  {emoji:'ğŸš«', label:'æ€§é¨·æ“¾é˜²æ²»', tip:'æ ¡åœ’èˆ‡è·å ´éœ€å®Œå–„é˜²æ²»æ©Ÿåˆ¶ã€‚'},
  {emoji:'ğŸ‘¶', label:'å®¶åº­è‚²å…’è² æ“”', tip:'è‚²å…’å¸¸ç”±å–®ä¸€æ€§åˆ¥æ‰¿æ“”ï¼Œå¼•ç™¼ä¸å¹³ç­‰ã€‚'},
  {emoji:'ğŸ«', label:'æ€§åˆ¥æ•™è‚²', tip:'æ¨å‹•æ­£ç¢ºçš„æ€§åˆ¥å¹³ç­‰æ•™è‚²ã€‚'},
  {emoji:'ğŸ§‘â€âš–ï¸', label:'æ€§åˆ¥æ­§è¦–äº‹ä»¶', tip:'æé«˜é€šå ±ç‡ä¸¦å®Œå–„ä¿è­·ç³»çµ±ã€‚'},

  /* ---- SDG11ï¼šæ°¸çºŒåŸå¸‚ ---- */
  {emoji:'ğŸš‡', label:'å¤§çœ¾é‹è¼¸', tip:'æå‡ä¾¿æ·æ€§å¯æ¸›å°‘äº¤é€šå£…å¡ã€‚'},
  {emoji:'ğŸ›»', label:'äº¤é€šå£…å¡', tip:'éƒ½å¸‚è»Šè¼›éå¤šé€ æˆæ±¡æŸ“èˆ‡æ™‚é–“æµªè²»ã€‚'},
  {emoji:'ğŸ™ï¸', label:'ç¶ åœ°ä¸è¶³', tip:'åŸå¸‚æ‡‰å¢åŠ å…¬åœ’èˆ‡ä¼‘æ†©ç©ºé–“ã€‚'},
  {emoji:'â™»ï¸', label:'ç¤¾å€å›æ”¶', tip:'åšå¥½å›æ”¶åˆ†é¡æ¸›å°‘åƒåœ¾é‡ã€‚'},
  {emoji:'ğŸŒƒ', label:'å…‰å®³å•é¡Œ', tip:'éé‡ç…§æ˜å½±éŸ¿ç”Ÿæ…‹èˆ‡äººé«”ä½œæ¯ã€‚'},
  {emoji:'ğŸšš', label:'ç‰©æµé…é€', tip:'æå‡é‹è¼¸æ•ˆç‡æ¸›å°‘èƒ½æºæµªè²»ã€‚'},
  {emoji:'ğŸ›œ', label:'æ™ºæ…§åŸå¸‚', tip:'é‹ç”¨ç§‘æŠ€æ”¹å–„äº¤é€šèˆ‡èƒ½æºä½¿ç”¨ã€‚'},
  {emoji:'ğŸ“¦', label:'å»¢æ£„ç‰©ç®¡ç†', tip:'è‰¯å¥½çš„å»¢æ£„ç‰©æµé€šå¯æå‡å›æ”¶ç‡ã€‚'},

  /* ---- SDG12ï¼šè²¬ä»»æ¶ˆè²» ---- */
  {emoji:'ğŸ§´', label:'æ¸›å¡‘è¡Œå‹•', tip:'ä½¿ç”¨ç’°ä¿è¢‹ã€ç’°ä¿æ¯æ¸›å°‘ä¸€æ¬¡æ€§å¡‘æ–™ã€‚'},
  {emoji:'ğŸ¥¤', label:'éåº¦åŒ…è£', tip:'é¸æ“‡ç°¡ç´„åŒ…è£æ¸›å°‘å»¢æ£„ç‰©ã€‚'},
  {emoji:'ğŸ›', label:'é£Ÿç‰©æµªè²»', tip:'é»é¤ä¸éé‡ï¼Œçæƒœé£Ÿç‰©ã€‚'},
  {emoji:'ğŸ§µ', label:'å¿«æ™‚å°šå•é¡Œ', tip:'ä½åƒ¹æœé£¾é€ æˆå¤§é‡æµªè²»èˆ‡æ±¡æŸ“ã€‚'},
  {emoji:'ğŸ”§', label:'ä¿®è£œæ–‡åŒ–', tip:'ç¶­ä¿®èˆŠç‰©æ¯”ä¸Ÿæ£„æ›´ç’°ä¿ã€‚'},
  {emoji:'ğŸ“¦', label:'å¾ªç’°åŒ…è£', tip:'é‡è¤‡ä½¿ç”¨åŒ…æå¯é™ä½è³‡æºæ¶ˆè€—ã€‚'},
  {emoji:'ğŸ›ï¸', label:'è¡å‹•æ¶ˆè²»', tip:'è³¼è²·å‰å…ˆæ€è€ƒæ˜¯å¦éœ€è¦ã€‚'},
  {emoji:'ğŸ§ª', label:'å®¶ç”¨åŒ–å­¸å“', tip:'é¿å…éåº¦ä½¿ç”¨æ¸…æ½”åŠ‘é€ æˆæ°´æ±¡æŸ“ã€‚'},

  /* ---- SDG17ï¼šå…¬æ°‘åƒèˆ‡ ---- */
  {emoji:'ğŸ“¢', label:'ç¤¾æœƒå€¡è­°', tip:'é€éè¡Œå‹•å½±éŸ¿æ”¿ç­–èˆ‡ç¤¾æœƒã€‚'},
  {emoji:'ğŸ—³ï¸', label:'å…¬æ°‘æŠ•ç¥¨', tip:'ç©æ¥µåƒèˆ‡æ°‘ä¸»æ©Ÿåˆ¶ã€‚'},
  {emoji:'ğŸ§­', label:'åª’é«”è­˜è®€', tip:'è¾¨è­˜å‡è¨Šæ¯é¿å…èª¤å°ã€‚'},
  {emoji:'ğŸ¤', label:'è·¨éƒ¨é–€åˆä½œ', tip:'æ”¿åºœã€ä¼æ¥­ã€æ°‘é–“åˆä½œæ‰èƒ½æ¨å‹•æ°¸çºŒã€‚'},
  {emoji:'ğŸ“¨', label:'å…¬å…±é€šå ±', tip:'ä½¿ç”¨æ”¿åºœç®¡é“åæ˜ å•é¡Œã€‚'},
  {emoji:'ğŸ§©', label:'ç¤¾å€å¿—å·¥', tip:'åƒèˆ‡å¿—å·¥æœå‹™æ”¹å–„ç¤¾å€ã€‚'},
  {emoji:'ğŸ“', label:'çµ‚èº«å­¸ç¿’', tip:'æŒçºŒæå‡çŸ¥è­˜èˆ‡æŠ€èƒ½ã€‚'},
  {emoji:'ğŸŒ', label:'é–‹æ”¾è³‡æ–™', tip:'åˆ©ç”¨å…¬é–‹è³‡è¨Šæå‡é€æ˜åº¦ã€‚'}
];


/* ================== DOM ================== */
const gridEl   = document.getElementById('grid');
const timeEl   = document.getElementById('time');
const timebar  = document.getElementById('timebar');
const movesEl  = document.getElementById('moves');
const matchEl  = document.getElementById('matches');
const pairsEl  = document.getElementById('pairs');
const toastEl  = document.getElementById('toast');
const overlay  = document.getElementById('overlay');
const resultTitle  = document.getElementById('resultTitle');
const resultText   = document.getElementById('resultText');
const playAgainBtn = document.getElementById('playAgainBtn');
const restartBtn   = document.getElementById('restartBtn');
const levelSel     = document.getElementById('levelSel');
const missionEl    = document.getElementById('mission');
const chipsEl      = document.getElementById('progressChips');
const unlockedEl   = document.getElementById('unlocked');
const needEl       = document.getElementById('need');
const knowEl       = document.getElementById('know');
const rankTable    = document.getElementById('rank').querySelector('tbody');
const nickInput    = document.getElementById('nick');
const saveBtn      = document.getElementById('saveScoreBtn');
const shareInput   = document.getElementById('shareUrl');
const copyBtn      = document.getElementById('copyBtn');

/* ================== ç‹€æ…‹ ================== */
let GRID_SIZE = LEVELS[LV].size;
let TIME_LIMIT = LEVELS[LV].time;
const FLIP_DELAY = 600;

let deck = [];
let first = null, second = null, lock = false;
let moves = 0, matched = 0, timer = null, timeLeft = TIME_LIMIT;
let discovered = new Set();
let lastRetentionScore = 0;  // âœ… æ–°å¢ï¼šæœ€å¾Œä¸€æ¬¡éŠæˆ²çš„è¨˜æ†¶ç•™å­˜åº¦åˆ†æ•¸


/* ================== å·¥å…· ================== */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }
function format(sec){ const m=Math.floor(sec/60).toString().padStart(2,'0'); const s=(sec%60).toString().padStart(2,'0'); return `${m}:${s}` }
function showToast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),1200); }
function showKnow(label){
  const icon = ESG_ICONS.find(x=>x.label===label);
  if(!icon) return;
  knowEl.innerHTML = `<strong>${icon.emoji} ${label}</strong>ï¼š${icon.tip}`;
  knowEl.style.display='block';
  setTimeout(()=>{ knowEl.style.display='none' }, 2600);
}

/* ================== ç‰Œçµ„ & ç‰ˆé¢ ================== */
function makeDeck(){
  const pairs = (GRID_SIZE * GRID_SIZE) / 2;
  
  // ğŸ§© ä¾é—œå¡é¸å–è©²éšæ®µçš„ 8 å¼µå¡
  const start = LV * 8;            // æ¯éšæ®µ 8 å¼µå¡
  const end   = start + 8;
  const stageCards = ESG_ICONS.slice(start, end);

  // å¾è©²éšæ®µ 8 å¼µå¡ä¸­å†æŠ½å‡ºéœ€è¦çš„é…å°æ•¸é‡
  const base = shuffle([...stageCards]).slice(0, pairs);

  // é›™ä»½åŒ–é…å°ä¸¦æ‰“äº‚
  const doubled = base.flatMap((it, idx) => [
    { ...it, id: idx + 'A' },
    { ...it, id: idx + 'B' }
  ]);

  return shuffle(doubled);
}

function renderGrid(){
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE},1fr)`;
  deck.forEach(card=>{
    const cell = document.createElement('div');
    cell.className='card';
    cell.dataset.key = card.id;
    cell.dataset.label = card.label;
    cell.innerHTML = `
      <div class="inner">
        <div class="face front" aria-hidden="true"></div>
        <div class="face back" role="img" aria-label="${card.label}">
          <div class="emoji">${card.emoji}</div>
          <div class="label">${card.label}</div>
        </div>
      </div>`;
    cell.addEventListener('click', onFlip);
    gridEl.appendChild(cell);
  });
}

/* ================== äº’å‹• ================== */
function onFlip(e){
  const el = e.currentTarget;
  if(lock || el.classList.contains('flipped') || el.classList.contains('matched')) return;
  el.classList.add('flipped');

  if(!first){ first = el; return; }
  second = el; lock = true; moves++; movesEl.textContent = moves;

  const same = first.dataset.label === second.dataset.label;
  if(same){
    setTimeout(()=>{
      first.classList.add('matched');
      second.classList.add('matched');
      matched++; matchEl.textContent = matched;

      const lab = first.dataset.label;
      discovered.add(lab); renderChips(); showToast(`é…å°æˆåŠŸï¼š${lab}`); showKnow(lab);

      resetPick();
      if(matched === deck.length/2) endGame(true);
    }, 140);
  }else{
    setTimeout(()=>{ first.classList.remove('flipped'); second.classList.remove('flipped'); resetPick(); }, FLIP_DELAY);
  }
}
function resetPick(){ first=null; second=null; lock=false; }

/* ================== è¨ˆæ™‚ ================== */
function startTimer(){
  timeLeft = TIME_LIMIT;
  timeEl.textContent = format(timeLeft);
  timebar.style.width = '100%';
  if(timer) clearInterval(timer);
  timer = setInterval(()=>{
    timeLeft--;
    timeEl.textContent = format(timeLeft);
    timebar.style.width = Math.max(0,(timeLeft/TIME_LIMIT)*100)+'%';
    if(timeLeft<=0){ clearInterval(timer); endGame(false); }
  },1000);
}

/* ================== ä»»å‹™ / å°å¡é€²åº¦ ================== */
function renderMission(){ 
  const lv = LEVELS[LV];
  missionEl.textContent = `${lv.name}ï¼š${lv.desc}ï¼ˆé™æ™‚ ${lv.time} ç§’å…§å®Œæˆæ‰€æœ‰é…å°ï¼Œæ­¥æ•¸ â‰¤ ${lv.targetMoves} ç‚ºé”æ¨™ï¼‰`;
}

function updateStage(){
  const stageEl = document.getElementById('stageNow');
  if(stageEl) stageEl.textContent = LEVELS[LV].name;
}

function renderChips(){
  chipsEl.innerHTML = '';
  [...discovered].forEach(lab=>{
    const chip = document.createElement('span');
    chip.className='chip';
    const em = ESG_ICONS.find(x=>x.label===lab)?.emoji || 'â™»ï¸';
    chip.textContent = `${em} ${lab}`; chipsEl.appendChild(chip);
  });
  unlockedEl.textContent = discovered.size; needEl.textContent = (GRID_SIZE*GRID_SIZE)/2;
}

/* ================== é–‹å±€ / çµæŸ ================== */
function startGame(){
  levelSel.value = LV; // â­ å§‹çµ‚ä¿æŒé¸å–®é¡¯ç¤ºèˆ‡ LV ä¸€è‡´
  // âœ… æ¯æ¬¡é–‹å§‹æ–°é—œå¡éƒ½éš±è—åˆ†äº«èˆ‡æš±ç¨±å€
  document.querySelectorAll('.row').forEach(r => r.style.display = 'none');
  overlay.style.display='none';
  updateStage();
  const lv = LEVELS[LV]; GRID_SIZE=lv.size; TIME_LIMIT=lv.time;

  deck = makeDeck(); first=second=null; lock=false; moves=0; matched=0; discovered=new Set();
  movesEl.textContent='0'; matchEl.textContent='0'; pairsEl.textContent=(deck.length/2);
  renderGrid(); renderMission(); renderChips();

  document.querySelectorAll('.card').forEach(el=>el.classList.add('flipped'));
  setTimeout(()=>document.querySelectorAll('.card').forEach(el=>el.classList.remove('flipped')),700);
  startTimer();
}

/* ================== é€²å…¥ä¸‹ä¸€éšæ®µ ================== */
function nextStage(){
  LV++;
  if(LV >= LEVELS.length){
    showToast('ğŸ‰ ä½ å·²å®Œæˆ SDGs å­¸ç¿’ä»»å‹™ï¼');
    overlay.style.display = 'flex';
    resultTitle.textContent = 'å…¨é—œå¡å®Œæˆ ğŸ¯';
    resultText.innerHTML = 'ğŸ‰æ­å–œï¼ä½ å·²ç†è§£éƒ¨åˆ†ç›¸é—œ SDGs çŸ¥è­˜ã€‚';
    return;
  }
  showToast(`ğŸŒ é€²å…¥ä¸‹ä¸€é—œå¡ï¼š${LEVELS[LV].name}`);
  levelSel.value = LV;  // â­ æ–°å¢ï¼šæ›´æ–°é—œå¡é¸å–®é¡¯ç¤º
  setTimeout(()=>startGame(), 1000);
}

function endGame(win){
  lock = true;
  const timeUsed = TIME_LIMIT - timeLeft;
  const lv = LEVELS[LV];
  const pass = win && (moves <= lv.targetMoves);

  const resultTxt = win
    ? `<b>${LEVELS[LV].name}</b> å®Œæˆï¼<br>${LEVELS[LV].desc}<br><br>ä½ ç”¨äº† <b>${moves}</b> æ­¥å®Œæˆå…¨éƒ¨é…å°ï¼Œè€—æ™‚ <b>${format(timeUsed)}</b>ã€‚`
    : `å·²å®Œæˆ <b>${matched}</b> çµ„ï¼›å†åŠ æ²¹ï¼`;

  // âœ… æ–°å¢ï¼šè¨ˆç®—è¨˜æ†¶ç•™å­˜åº¦
  if (win) {
    const totalPairs = deck.length / 2;
    const efficiency = totalPairs / moves;
    lastRetentionScore = Math.round(efficiency * 100);
  }

  resultTitle.textContent = win ? 'é—œå¡å®Œæˆ ğŸ‰' : 'æ™‚é–“åˆ°ï¼';
  resultText.innerHTML = resultTxt;

    // âœ… æ–°å¢ï¼šæŠŠè¨˜æ†¶ç•™å­˜åº¦é¡¯ç¤ºçµ¦ç©å®¶ï¼ˆåªåœ¨éé—œæ™‚ï¼‰
  if (win) {
    resultText.innerHTML += `
      <br><br>
      <span style="font-size:14px;color:#0E63E6;">
        ğŸ“Š è¨˜æ†¶ç•™å­˜åº¦ï¼š<b>${lastRetentionScore}</b> åˆ†
        ï¼ˆä¾ã€Œé…å°æ•ˆç‡ï¼å®Œæˆçµ„æ•¸ Ã· æ­¥æ•¸ã€è¨ˆç®—ï¼‰
      </span>
    `;
  }


  /* âœ… è‹¥éæœ€å¾Œä¸€é—œï¼Œå‡ºç¾ã€Œé–‹å§‹ä¸‹ä¸€é—œã€ */
  if (win && LV < LEVELS.length - 1) {
    resultText.innerHTML += `<br><br><button id="nextBtn" class="btn">é–‹å§‹ä¸‹ä¸€é—œ</button>`;
    setTimeout(() => {
      document.getElementById("nextBtn").addEventListener("click", () => {
        overlay.style.display = "none";
        nextStage(); // âœ… æ‰‹å‹•é€²å…¥ä¸‹ä¸€é—œ
      });
    }, 200);
  }

  /* âœ… è‹¥æ˜¯æœ€å¾Œä¸€é—œï¼Œæ‰é¡¯ç¤ºåˆ†äº«é€£çµèˆ‡æš±ç¨±è¼¸å…¥ */
  else if (win && LV === LEVELS.length - 1) {
    resultTitle.textContent = "æŒ‘æˆ°æˆåŠŸ ğŸ¯";
    resultText.innerHTML += `
      <br><br>ä½ å·²å®Œæˆæ‰€æœ‰å…­å€‹é—œå¡ä»»å‹™ï¼
      <br><br>ç•™ä¸‹ä½ çš„åå­—èˆ‡é€£çµåˆ†äº«æˆæœğŸ‘‡`;
    // âœ… é¡¯ç¤º overlay ä¸­çš„æš±ç¨±èˆ‡åˆ†äº«åˆ—
    document.querySelectorAll('.row').forEach(r => r.style.display = 'flex');
  } 
  else {
    // è‹¥å¤±æ•—éš±è—æš±ç¨±ã€åˆ†äº«å€
    document.querySelectorAll('.row').forEach(r => r.style.display = 'none');
  }

  // âœ… æ›´æ–°åˆ†äº«é€£çµ
  const url = new URL(window.location.href);
  url.searchParams.set("lv", String(LV));
  url.searchParams.set("size", String(GRID_SIZE));
  url.searchParams.set("moves", String(moves));
  url.searchParams.set("time", String(timeUsed));
  url.searchParams.set("ts", String(Date.now()));
  shareInput.value = url.toString();

  overlay.style.display = "flex";
}



/* ================== æ’è¡Œæ¦œï¼ˆæœ¬æ©Ÿï¼‰ ================== */
const STORE_KEY = 'esg_memory_leaderboard_v2';
function loadLB(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)||'[]') }catch{ return [] } }
function saveLB(list){ localStorage.setItem(STORE_KEY, JSON.stringify(list)) }
function pushScore(nick, lvIdx, size, timeUsed, moves){
  const list = loadLB();
  list.push({nick:nick||'â€”', level:LEVELS[lvIdx].name, size, timeUsed, moves, date:new Date().toLocaleDateString()});
  list.sort((a,b)=> a.timeUsed-b.timeUsed || a.moves-b.moves);
  saveLB(list.slice(0,10)); renderLB();
}
function renderLB(){
  const list = loadLB();
  rankTable.innerHTML = list.map((r,i)=>(
    `<tr><td>${i+1}</td><td>${escapeHtml(r.nick)}</td><td>${r.level}</td><td>${format(r.timeUsed)}</td><td>${r.moves}</td><td>${r.date}</td></tr>`
  )).join('');
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,(m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }

/* ================== äº‹ä»¶ ================== */
playAgainBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
levelSel.addEventListener('change', ()=>{ LV = Number(levelSel.value); startGame(); });
document.getElementById('saveScoreBtn').addEventListener('click', ()=>{
  const timeUsed = TIME_LIMIT - timeLeft;
  pushScore(nickInput.value.trim(), LV, GRID_SIZE, timeUsed>0?timeUsed:TIME_LIMIT, moves);
  showToast('å·²å„²å­˜åˆ°æ’è¡Œæ¦œ');
});
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(shareInput.value); showToast('é€£çµå·²è¤‡è£½'); }
  catch{ shareInput.select(); document.execCommand('copy'); showToast('å·²è¤‡è£½ï¼ˆå‚™æ´ï¼‰'); }
});

/* ================== å•Ÿå‹• ================== */
renderLB(); LV = 0; // âœ… ç¢ºä¿å¾ç¬¬ä¸€é—œé–‹å§‹ 
startGame();
(function readShare(){
  const u = new URL(window.location.href);
  const qMoves = u.searchParams.get('moves');
  const qTime  = u.searchParams.get('time');
  const qLv    = u.searchParams.get('lv');
  if(qMoves && qTime){ showToast(`ä¾†è‡ªåˆ†äº«ï¼š${LEVELS[Number(qLv)||0].name} æˆç¸¾ ${format(Number(qTime))}ï¼${qMoves} æ­¥`) }
})();
</script>
<!-- ================== èƒŒæ™¯ç²’å­ ================== -->
<script>
(function(){
  const canvas = document.getElementById('bg-canvas'); 
  if(!canvas) return;
  const ctx = canvas.getContext('2d', { alpha:true });
  let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1);

  /* èª¿è‰²ï¼ˆè·Ÿ Aurora è‰²ç³»ä¸€è‡´ï¼‰ */
  const styles=getComputedStyle(document.documentElement);
  const C1=(styles.getPropertyValue('--aurora-1')||'#00ffa3').trim();
  const C2=(styles.getPropertyValue('--aurora-2')||'#00d4ff').trim();

  /* ç²’å­è¨­å®š */
  const SYMBOLS = ['Â·','Â·','Â·','âœ§','âœ¦']; // ä»¥å°é»ï¼‹æ˜Ÿå…‰ç‚ºä¸»
  const COUNT = Math.max(40, Math.min(90, Math.round((innerWidth*innerHeight)/28000)));
  const SPEED = 0.40;
  const ALPHA = 0.35;

  const items = [];
  function rand(a,b){ return a + Math.random()*(b-a) }
  function pick(a){ return a[Math.floor(Math.random()*a.length)] }

  function resize(){
    W = canvas.width  = Math.floor(innerWidth * DPR);
    H = canvas.height = Math.floor(innerHeight* DPR);
    canvas.style.width = innerWidth + 'px';
    canvas.style.height= innerHeight+ 'px';
  }

  function spawn(i=0){
    const sym = pick(SYMBOLS);
    const isDot = (sym==='Â·');
    items[i] = {
      sym, x: rand(0,W), y: rand(0,H),
      vx: rand(-SPEED,SPEED)*DPR, vy: rand(-SPEED*0.6,SPEED)*DPR,
      size: isDot ? rand(1.2,2.4)*DPR : rand(10,20)*DPR,
      rot: rand(0,Math.PI*2), spin: rand(-0.002,0.002),
      alpha: ALPHA, color: Math.random()<0.5?C1:C2
    };
  }

  function glow(hex, a){
    const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    if(!m) return `rgba(255,255,255,${a})`;
    const r=parseInt(m[1],16), g=parseInt(m[2],16), b=parseInt(m[3],16);
    return `rgba(${r},${g},${b},${a})`;
  }

  function wrap(o){ 
    if(o.x<-40)o.x=W+40; if(o.x>W+40)o.x=-40; 
    if(o.y<-40)o.y=H+40; if(o.y>H+40)o.y=-40; 
  }

  function step(){
    ctx.clearRect(0,0,W,H);

    // æŸ”å…‰æšˆï¼ˆAurora Glowï¼‰
    const g = ctx.createRadialGradient(W*0.25,H*0.25,0, W*0.25,H*0.25, Math.max(W,H)*0.6);
    g.addColorStop(0, glow(C2, .10)); g.addColorStop(1, 'rgba(0,0,0,0)');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

    items.forEach(o=>{
      o.x+=o.vx; o.y+=o.vy; o.rot+=o.spin; wrap(o);
      ctx.save(); ctx.translate(o.x,o.y); ctx.rotate(o.rot); ctx.globalAlpha=o.alpha;
      if(o.sym==='Â·'){ // dot
        ctx.fillStyle=o.color; ctx.beginPath(); ctx.arc(0,0,o.size,0,Math.PI*2); ctx.fill();
      }else{ // star
        ctx.font=`${o.size}px system-ui,Apple Color Emoji,Segoe UI Symbol`;
        ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillStyle=o.color; ctx.fillText(o.sym,0,0);
      }
      ctx.restore();
    });

    requestAnimationFrame(step);
  }

  resize(); for(let i=0;i<COUNT;i++) spawn(i); requestAnimationFrame(step);
  addEventListener('resize', resize, {passive:true});
})();
</script>

</body>
</html>